<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>This is oziroe.</title>
  <subtitle>Please call me cowsay.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://oziroe.github.io/"/>
  <updated>2017-08-16T04:18:48.000Z</updated>
  <id>https://oziroe.github.io/</id>
  
  <author>
    <name>oziroe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一时兴起而读《三体》</title>
    <link href="https://oziroe.github.io/2017/08/16/%E4%B8%80%E6%97%B6%E5%85%B4%E8%B5%B7%E8%80%8C%E8%AF%BB%E3%80%8A%E4%B8%89%E4%BD%93%E3%80%8B/"/>
    <id>https://oziroe.github.io/2017/08/16/一时兴起而读《三体》/</id>
    <published>2017-08-16T03:37:51.000Z</published>
    <updated>2017-08-16T04:18:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>多年前看过一次《三体》，印象深刻。这次跳过了第一本的世界观铺垫，原计划只看第二本省得心情不好，不过还是忍不住都看完了。</p>
<a id="more"></a>
<p>《三体》中的一部分情节反映出作者“自暴自弃”的写作手法。这是一篇被当作说明书来写的小说，它只考虑了情节逻辑的连续性而完全没有在意文笔的连续性。因此可以感受到作者在书的背后说：“我让程心去这四个太空城就是为了让她刚刚好看到宇宙背景下的人类社会长成什么样子，从而让读者感受到其与当今社会的相似程度。但我又不能写一句话，‘虽然来到了掩体背后，但人类社会与几百年前在组成等方面毫无区别’，所以……”</p>
<p>最初看科幻小说时，我的期待很低。类似于《三体》这样的世界观架构，我只希望作者把“这样的世界按照合理的逻辑演化会发生什么”这一个问题回答得够好就行了，哪怕像第一部那样玩着一些无所谓的吊胃口也无所谓。然而接下来，作者又不仅仅是在证明数学题了，而是在这个架构之上开始讲故事，做任务，从而让我眼前一亮（大概还是眼界太窄了）。虽然说作者讲故事的目的就是为了影射，而他的手法也比较差劲，让人不仅仅觉得他是在为了影射而影射，甚至是为了影射他想影射的现象而影射，不过也都无所谓了，毕竟我的期望很低的。不过以此来说这部小说文笔差劲，倒也不过分。这也许是一种宿命，因为这个故事，换作任何一个写文章不像说明书的人来写，恐怕发展也是截然不同的。</p>
<p>虽说我说自己是来看结局的，但是这个结局还是有点谐谑得超出我的接受能力，从而让我更愿意就其说教作更深层次的分析。事实上，作者通过程心所抨击的，是我们这个时代的某些苗头，而远非几百年后才会出现的社会潮流。就这一点来说，作者的预测非常准确，因为大量的“程心”在小说完成之后几年出现了，现在被我们称为：圣母婊。</p>
<p>作者想讽刺得也不是个体的圣母婊倾向，而是整个社会的。直接写一个社会的行为比较没意思，所以将其特征化赋予一个突出的个体，然后通过“整个社会认同她”的方式进行这个故事。在一个知乎回答的提示下我注意到程心小时候的行为，想要一个爸爸，就有了爸爸，不想要更多了就没有弟弟妹妹。这反映在一个人身上叫做溺爱，反映在一个社会、一个种族上呢？没有对应的词，但的确是我们社会的一个写照。人类就像小时的程心一样，要什么有什么，由此养成了自负的性格，也是一样的原理，一样的结果。</p>
<p>这种自负的具体体现，就是所谓“人道主义”。小时候我就想过，进化论的核心是适者生存，然而在人类社会里，残障人士、低能人士等显然非常的“不适”了，却可以在人道主义的帮助下同样生存下来，这等于是推翻了进化论存在的基础。如此一来，人类还如何进化？</p>
<p>《三体》考虑得比我要现实的多。人道主义如今几乎已经成为不容置疑的真理，而它的推论却总让人觉得哪里不对。而《三体》就通过讲述“受人道主义支配的人类社会走向灭亡”这个故事，具体的讲明了到底哪里不对。抑或说，它给出了一个反例，说明这并不是真理，只要你不承认人类应该自取灭亡。</p>
<p>在第三部当中，有意而为之地让程心做出了多个集中体现人道主义的选择，大者如放弃广播、劝降星环城；小者如在第一次误报时先是一定要带三个孩子逃命又决定不逃命了（孩子：“妈卖批”），如结局处回归运动一忽悠就放弃了小宇宙，把黑暗森林一股脑抛到脑后，非要离开小宇宙（云天明：“妈卖批”）。人道主义看似在自残，其实能够给人一种快感，就如程心在备忘录中所写，她感觉自己仿佛开始承担越来越大的责任，压力好大啊。其实她自己有多向往这种“压力”，读者非常清楚。当作者刻意把这种行为造成的恶果描写出来时，大家都唾弃她；但是在情节不是那么激烈的部分，比如程心几次冬眠的理由都是“我为人类做出好大的贡献，我必须要躲着那些感谢我的人”的时候，有多少人会下意识地觉得这个逻辑没什么问题？事实上，把我们中的大多数人放在程心的位置上，我们做出的行为不一定比她好到哪里去；如果社会的大多数人都是如此，那么我们的社会的发展也和小说中的描述不会有太大区别。一边嘲笑程心一边又不能心安理得地说“我要是她我肯定不会……”这样的话，于是大家更讨厌她了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;多年前看过一次《三体》，印象深刻。这次跳过了第一本的世界观铺垫，原计划只看第二本省得心情不好，不过还是忍不住都看完了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="三体" scheme="https://oziroe.github.io/tags/%E4%B8%89%E4%BD%93/"/>
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>使用Ruby与Lex/Yacc一起构建编译器的第一步</title>
    <link href="https://oziroe.github.io/2017/08/12/%E4%BD%BF%E7%94%A8Ruby%E4%B8%8ELex-Yacc%E4%B8%80%E8%B5%B7%E6%9E%84%E5%BB%BA%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AD%A5/"/>
    <id>https://oziroe.github.io/2017/08/12/使用Ruby与Lex-Yacc一起构建编译器的第一步/</id>
    <published>2017-08-12T14:01:06.000Z</published>
    <updated>2017-08-12T14:44:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>首先这个编译器的目标语言已经不叫oz了。对，只是不叫而已。毕竟不能让自己老是在做技术选型，从纯C（并搭配Ruby生成C代码……）到CoffeeScript再到Ruby。所以改个名字，警示自己一下。新的名字叫Daze（迷糊），嗯，起贱名好养活。现在GitHub上的代码仓库还是之前Ruby生成C的那一版，等手上这个完成一次merge的工作量后再上传。</p>
<a id="more"></a>
<p>目前的语言/编译器的进展可以概括如下。源代码（凑合看吧）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">use &quot;./Standard&quot; &gt;&gt; int</div><div class="line"></div><div class="line">Main = () -&gt; int</div><div class="line">    return int(42)</div></pre></td></tr></table></figure>
<p>编译（或者说解析）结果（经过手动调整格式）</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"type"</span>=&gt;<span class="string">"def_list"</span>,</div><div class="line">  <span class="string">"def"</span>=&gt;&#123;</div><div class="line">    <span class="string">"type"</span>=&gt;<span class="string">"use_def"</span>,</div><div class="line">    <span class="string">"path"</span>=&gt;<span class="string">"./Standard"</span>,</div><div class="line">    <span class="string">"used"</span>=&gt;<span class="string">"int"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"next"</span>=&gt;&#123;</div><div class="line">    <span class="string">"type"</span>=&gt;<span class="string">"def_list"</span>,</div><div class="line">    <span class="string">"def"</span>=&gt;&#123;</div><div class="line">      <span class="string">"type"</span>=&gt;<span class="string">"func_def"</span>,</div><div class="line">      <span class="string">"head"</span>=&gt;<span class="string">"Main"</span>,</div><div class="line">      <span class="string">"body"</span>=&gt;&#123;</div><div class="line">        <span class="string">"type"</span>=&gt;<span class="string">"block"</span>,</div><div class="line">        <span class="string">"inner"</span>=&gt;&#123;</div><div class="line">          <span class="string">"type"</span>=&gt;<span class="string">"stat_list"</span>,</div><div class="line">          <span class="string">"stat"</span>=&gt;&#123;</div><div class="line">            <span class="string">"type"</span>=&gt;<span class="string">"return_stat"</span>,</div><div class="line">            <span class="string">"expr"</span>=&gt;&#123;</div><div class="line">              <span class="string">"type"</span>=&gt;<span class="string">"expr3"</span>,</div><div class="line">              <span class="string">"func"</span>=&gt;<span class="string">"int"</span>,</div><div class="line">              <span class="string">"expr"</span>=&gt;<span class="number">42</span></div><div class="line">            &#125;</div><div class="line">          &#125;,</div><div class="line">          <span class="string">"next"</span>=&gt;&#123;</div><div class="line">            <span class="string">"type"</span>=&gt;<span class="string">"stat_empty"</span></div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"next"</span>=&gt;&#123;</div><div class="line">      <span class="string">"type"</span>=&gt;<span class="string">"def_empty"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>之所以层次这么多是因为所有的列表都以双元素链表字典的方式存在。这样可以在一定程度上减轻编译器的实现难度（就是懒）。不过说真的，写到这里我开始有点不懂了。这么好的技术搭配，为什么从来没见到有人用过？从来？？显然，代码的世界还有许多的未知之地在等着我去冒险。</p>
<p>目前项目的<code>Source</code>目录下有以下内容</p>
<ul>
<li><code>Main.rb</code>入口，命令行界面</li>
<li><code>Compile.rb</code>主要且唯一的编译封装界面</li>
<li><code>Parser</code>文件夹，下属各源码解析文件<ul>
<li><code>Scanner.l</code>/<code>Parser.y</code>是Lex和Yacc的输入文件</li>
<li><code>Bridge.h</code>/<code>Bridge.c</code>定义了上述两个文件中用到的Ruby方法，以及整个Parser暴露给Ruby项目的接口</li>
<li><code>extconf.rb</code>用于生成Makefile，<code>build.sh</code>负责文件夹的整个构建过程。编译过后，<code>Parser</code>文件夹旁边会多出来一个<code>Parser.bundle</code>文件，在Ruby看来和一个普通的<code>Parser.rb</code>没什么区别。</li>
</ul>
</li>
</ul>
<p>这篇文章主要集中在讨论<code>Parser</code>文件夹下。我们知道在Yacc的输入文件当中，每一个终结符/非终结符都是有值的。通常来说这个值的类型是不统一的，但是有了Ruby就不一样了。Ruby良好的C API使得所有结果具有同一个类型<code>VALUE</code>，哪怕不像我这般几乎全用Hash也是一样。不仅如此，Ruby提供的接口会让你感觉你写的并不是C，只是语法稍微拙劣了一点的Ruby。下面的函数为一个非终结符创建起对应在AST上的节点</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function">VALUE <span class="title">CreateNode</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *type, <span class="keyword">const</span> <span class="keyword">int</span> child_count, ...)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  VALUE node = rb_hash_new();</div><div class="line">  rb_hash_aset(node, rb_str_new_cstr(<span class="string">"type"</span>), rb_str_new_cstr(type));</div><div class="line"></div><div class="line">  va_list ap;</div><div class="line">  va_start(ap, child_count);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; child_count; i++)</div><div class="line">  &#123;</div><div class="line">      <span class="keyword">const</span> <span class="keyword">char</span> *name = va_arg(ap, <span class="keyword">const</span> <span class="keyword">char</span> *);</div><div class="line">      VALUE child = va_arg(ap, VALUE);</div><div class="line">      rb_hash_aset(node, rb_str_new_cstr(name), child);</div><div class="line">  &#125;</div><div class="line">  va_end(ap);</div><div class="line">  <span class="keyword">return</span> node;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中<code>rb_hash_aset(hash, key, value)</code>对应着<code>hash[key] = value</code>，而<code>rb_str_new_cstr</code>则以C风格的字符串为参数，创建Ruby中类型为<code>String</code>的变量（在C中的类型当然是<code>VALUE</code>）。用着Ruby的C API，真的让我感觉哪怕我不是为了给Ruby写拓展，仅仅是在写一个纯C的项目，我都想把它当成是一个代码库来用。一个有类型检查的<code>void *</code>，还有内建的垃圾收集，以及大量的实用工具……除了速度太慢以外堪称完美。</p>
<p>顺便一说，上面的C代码成功地把Atom的代码高亮玩坏掉了……真是太脆弱了。</p>
<p>有了统一类型<code>VALUE</code>，那么把<code>YYSTYPE</code>定为<code>VALUE</code>也就成了顺理成章的事情。然而也就是因为这个我发现了Yacc（Bison）的一个bug，哪怕到Google去搜也没法找到类似的情况。难道说我是第一个用这种姿势使用Yacc的人？震惊。</p>
<p>这个bug就是，用<code>-d</code>参数指示Yacc生成<code>y.tab.h</code>时，与<code>YYSTYPE</code>以及<code>yylval</code>相关的代码如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> ! defined YYSTYPE &amp;&amp; ! defined YYSTYPE_IS_DECLARED</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> YYSTYPE;</div><div class="line"><span class="meta"># <span class="meta-keyword">define</span> yystype YYSTYPE <span class="comment">/* obsolescent; will be withdrawn */</span></span></div><div class="line"><span class="meta"># <span class="meta-keyword">define</span> YYSTYPE_IS_DECLARED 1</span></div><div class="line"><span class="meta"># <span class="meta-keyword">define</span> YYSTYPE_IS_TRIVIAL 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> YYSTYPE yylval;</div></pre></td></tr></table></figure>
<p>虽然我在<code>Parser.y</code>/<code>y.tab.c</code>里的确定义了<code>YYSTYPE</code>，但是<code>y.tab.h</code>不可能知道这件事，因此不管我在Yacc里把它的类型定义成啥，在Lex里看到的<code>yylval</code>都是一个<code>int</code>类型的变量。由于某些兼容性问题，在链接的时候这个全局变量并不会引起报错，但我知道在Lex里面给<code>yylval</code>赋值时赋的值一定是先强制类型转化为<code>int</code>再赋的值，因为<code>VALUE</code>实际上就是<code>unsigned long</code>，在Ruby里相当于句柄一样的存在，而被转换为<code>int</code>以后，哪怕是简单的输出到屏幕都会引起Ruby虚拟机段错误崩溃。</p>
<p>哦对，只要简单的调用<code>rb_p</code>就可以把任何<code>VALUE</code>类型的变量输出到屏幕，这大概是我见过的最简单的print调试工作流了。</p>
<p>总之，在没有SO问题+没有文档相关+没有GH issue的情况下，我只好在Lex的头部首先把<code>YYSTYPE</code>也定义为<code>VALUE</code>在引用<code>y.tab.h</code>文件。这也许是最好的解决办法了吧。</p>
<hr>
<p>作为Daze语言的第一个用例，这个程序还是相当简单的，我只要解决<code>int</code>的问题就可以让它运行了。是的，<code>int</code>作为基本类型，却不是这个语言的一部分。这种允许用户自定义任何类型，无论基本还是复合的疯狂举动主要是为了回答自己的一个疑问：“为什么语言的类型要分为内建的和自定义的？”这样，我就不用回答这个问题了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;首先这个编译器的目标语言已经不叫oz了。对，只是不叫而已。毕竟不能让自己老是在做技术选型，从纯C（并搭配Ruby生成C代码……）到CoffeeScript再到Ruby。所以改个名字，警示自己一下。新的名字叫Daze（迷糊），嗯，起贱名好养活。现在GitHub上的代码仓库还是之前Ruby生成C的那一版，等手上这个完成一次merge的工作量后再上传。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Ruby" scheme="https://oziroe.github.io/tags/Ruby/"/>
    
      <category term="Lex" scheme="https://oziroe.github.io/tags/Lex/"/>
    
      <category term="Yacc" scheme="https://oziroe.github.io/tags/Yacc/"/>
    
      <category term="Daze" scheme="https://oziroe.github.io/tags/Daze/"/>
    
      <category term="C" scheme="https://oziroe.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>有关于Blue Fat的构想和计划</title>
    <link href="https://oziroe.github.io/2017/08/07/%E6%9C%89%E5%85%B3%E4%BA%8EBlue-Fat%E7%9A%84%E6%9E%84%E6%83%B3%E5%92%8C%E8%AE%A1%E5%88%92/"/>
    <id>https://oziroe.github.io/2017/08/07/有关于Blue-Fat的构想和计划/</id>
    <published>2017-08-07T10:18:06.000Z</published>
    <updated>2017-08-07T10:20:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>似曾相识的标题……一句题外话，Try2048的游戏部分基本算是完全确定了，刚刚好800行代码，看得我很舒服。还是原来那个<a href="https://github.com/oziroe/try-2048" target="_blank" rel="external">代码仓库</a>。不过过去种种删库行为让我现在都不太敢放这种链接了，因为现在回去看上上个月的博客，好多链接都没办法点了……说真的，以后可能都只能放个人主页链接了……</p>
<a id="more"></a>
<p>还记得之前立的Flag吗？要写一个Hexo客户端之类的。几乎就在那几天，我没有忍住在Windows上装了Dev-C++……不不，我现在也不觉得这是个好东西了，只是当年我就是在Windows7下用它入门的C/C++，所以单纯地念念旧罢了。不过下了编译器总是要写点程序的。于是我顺理成章地开了一个Win32图形程序的工程（怎么跟mc开存档似的……），写点什么呢？不是说要写博客客户端吗，那就试试吧。</p>
<p>经过几天时间，我得出以下几个结论。</p>
<p>第一，这玩意居然真的是可以写出来的。Hexo的部分和Git的部分分别把原生的环境复制一份到build底下，然后用Win32调命令执行就可以的；一个可选项，内建浏览器预览文章，要么可以走COM调系统的IE，要么还有一个神器<a href="https://bitbucket.org/chromiumembedded/cef" target="_blank" rel="external">CEF</a>可以用（话说我为什么作死不直接用Electron……），万事具备啊。插一嘴，正是因为我发现它好像要集成好多东西的样子，因此命名为Blue Fat，为什么？因为我不知道多拉A梦的官方英文名啊！</p>
<p>第二，Win32 API是个好东西。短短一周时间里，我已经先后对两件事物开始喜欢上了（前一个是Javascript），真是奇妙。如果我没有理解错的话，Win32这一套借口应该是Windows窗体最底层的基础，诸如WinForm、MFC乃至后面的WPF、UWP都是在其之上的再封装（当然同时封装了.NET一大堆就是啦），因此它就像是POSIX一样的存在。不过这个东西看着可比POSIX讨喜多了，厚重但是不陈旧，这是它给我的第一印象。虽然这段时间都在踩其中大大小小的坑（主要是我太笨了吧……），不过却还是给人一种奇怪的愉悦，不知Win32程序员是不是都有这种体会。说起来第一次接触Win32也是一件很源远流长的事情啊……真是越活越小了。</p>
<p>第三，Dev-C++这东西真的不能用了。别的都不说了，我只想要一个功能：我得<code>foo.cpp</code>依赖<code>bar.h</code>，给我一个按钮让我在<code>Makefile.win</code>里面可以添加这个依赖。如是我开始搜寻“小巧而好用的Win32开发环境”，嗯……我真想问问当时的自己，到底认为除了VS以外还能搜出什么？作为电脑性能不够所以装回Windows7和Office2010的人来说，我下意识地拒绝VS2010以后的版本……或者说任何看着“不圆”的东西。喜出望外，2010版的VS还是各个语言分开的，于是VC++ 2010 Express就成了比我想象中还要符合我预期的东西，Nice。</p>
<p>现在的我，除了namespace强制缩进以外，再无怨言。</p>
<p>希望拿记事本写博客的日子，少之又少。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;似曾相识的标题……一句题外话，Try2048的游戏部分基本算是完全确定了，刚刚好800行代码，看得我很舒服。还是原来那个&lt;a href=&quot;https://github.com/oziroe/try-2048&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;代码仓库&lt;/a&gt;。不过过去种种删库行为让我现在都不太敢放这种链接了，因为现在回去看上上个月的博客，好多链接都没办法点了……说真的，以后可能都只能放个人主页链接了……&lt;/p&gt;
    
    </summary>
    
    
      <category term="Try2048" scheme="https://oziroe.github.io/tags/Try2048/"/>
    
      <category term="Blue Fat" scheme="https://oziroe.github.io/tags/Blue-Fat/"/>
    
      <category term="Win32" scheme="https://oziroe.github.io/tags/Win32/"/>
    
      <category term="Dev-C++" scheme="https://oziroe.github.io/tags/Dev-C/"/>
    
      <category term="Visual Studio" scheme="https://oziroe.github.io/tags/Visual-Studio/"/>
    
  </entry>
  
  <entry>
    <title>急需一个新的对梦境的理解</title>
    <link href="https://oziroe.github.io/2017/08/07/%E6%80%A5%E9%9C%80%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%AF%B9%E6%A2%A6%E5%A2%83%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>https://oziroe.github.io/2017/08/07/急需一个新的对梦境的理解/</id>
    <published>2017-08-07T03:42:12.000Z</published>
    <updated>2017-08-07T03:43:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>在我更新自己的态度以后，梦境也开始出乎我的意料——我一直认为梦是以记忆作为素材的重新拼接，然而最近它却出现了记忆之外的情节。</p>
<p>昨晚的梦里，摄影师对正在做模特的我说，把你的脚后跟藏在膝盖内侧，就像——指了指身后的大幅海报——葛优这样。</p>
<p>我非常确定我的生活中没有出现过上面一段中的任何元素。</p>
<p>我也基本确定这超出了我的想象力范围。</p>
<p>如果这种事情再发生一次，我考虑为此设立一个新的标签，并多记录，以期发现其背后的原因。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在我更新自己的态度以后，梦境也开始出乎我的意料——我一直认为梦是以记忆作为素材的重新拼接，然而最近它却出现了记忆之外的情节。&lt;/p&gt;
&lt;p&gt;昨晚的梦里，摄影师对正在做模特的我说，把你的脚后跟藏在膝盖内侧，就像——指了指身后的大幅海报——葛优这样。&lt;/p&gt;
&lt;p&gt;我非常确定我
    
    </summary>
    
    
      <category term="破事水" scheme="https://oziroe.github.io/tags/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
  </entry>
  
  <entry>
    <title>狂想症中毒患者的生日篇章</title>
    <link href="https://oziroe.github.io/2017/08/04/%E7%8B%82%E6%83%B3%E7%97%87%E4%B8%AD%E6%AF%92%E6%82%A3%E8%80%85%E7%9A%84%E7%94%9F%E6%97%A5%E7%AF%87%E7%AB%A0/"/>
    <id>https://oziroe.github.io/2017/08/04/狂想症中毒患者的生日篇章/</id>
    <published>2017-08-04T15:38:55.000Z</published>
    <updated>2017-08-04T15:39:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>到明天为止，我就要满18岁了。</p>
<p>回顾一下自己曾经默默立下的Flag，除去那些极偶尔的，或已经忘却或已经离我远去的幻想，每个梦境，最晚都截止于18岁吧。</p>
<p>这和中二病的症状倒是很相似，除了一个幻想自己已经是什么，而一个幻想自己将要做且做成什么（本人是后者），已经——作为一个耿直的人，我不介意回顾这些所谓黑历史的存在，毕竟，“我”总共就这么多，仅仅因为个人审美就要扔掉一部分，实在是太浪费了。</p>
<a id="more"></a>
<hr>
<p>如今记得的最早的幻想，大概是年龄前某次母亲给我搓澡时，如往常一样滔滔不绝《十万个为什么》之内容之余，突然搭错一根脑回路，说道，我具有某某物质存在于体内，所以搓澡时没有水冲着也可以调节体温不会太冷。嗯，这最初的起源算是标准的缺乏生活经验的中二。此后“我有超能力”的概念发展成了一个体系，用来解释我为什么跑得比同学快、能通过狭窄的缝隙等一系列现象。后来的某一天母亲突然打趣说，你不是有什么什么能力吗怎么会冷。突然一阵不好意思。这大概是我最后一次体会到对自己思想的羞耻。</p>
<p>小学时的幻想集中在纸飞机上。我可以制造出能够持续飞行30~100千米的纸飞机（嗯，贴着地面飞的导弹吧），其内部有固体燃料提供推动力，并且可以在飞行过程中抛弃燃料用尽的外壳。为了这一幻想，还特地架设了一个“纸飞机世锦赛”的世界观，会有大量观众像围观F1比赛或是环法自行车赛一样，聚集在重点线以及各级外壳被抛弃的地点，在纸飞机飞过时大声欢呼。为了提高观赏性，纸飞机的尾焰大概类似于焰火，抛弃外壳时会同时抛洒大量纸屑，并且外壳会转而向上以消耗动能，再伴随着纷纷的纸屑打开降落伞慢慢落回地面上。同样，到达终点的纸飞机会像航天飞机一样尾部拖拽一个降落伞减速，并且伴随着大量纸屑。以上记忆的清晰不是由于我记性好，而是它们占据了十年前的我大约80%的清醒时间的大脑。世界观是次要的，只是方便自己理解和拓展故事，其中有几个场景，纸飞机一瞬间掠过人群，欢呼声中漫天纸片和戴着降落伞的外壳缓缓落地，诸如此类的场景是幻想的关键。我会不知疲倦的重复幻想这几秒钟的事，变换不同的拍摄角度（这导致若干年后我做的梦也大多说是电影视角的），稍微修改情节，在幻想的同时体会到某种快感。这一核心，即幻想场景感受快感，成为此后至今我所有幻想的动力来源。</p>
<p>这一时段的幻想的特点是和我本人没什么关系，伴随着我开始慢慢掌握自己的生活这一特点被打破。随着这种打破，问题也就来了：我幻想中自己的生活，早晚要被现实否定。这命题眼熟吧？多少大学生因为这一点而痛苦万分。我则老道得多，初中时便分得清幻想和“预测”之间的区别，并且对于前者的落空保持坦然的态度。这态度也一直保持到了现在。我几个月前的幻想大概是，赶在自己还未成年时，把oz抑或是4b写完并搞出一个大新闻（“oz成为某大学教学语言”或者“4b刷新渲染效率记录”之类），然后对着记者的采访摆出一副谦虚的嘴脸，并在记者问到“有没有什么想对同龄人说的”时说：“17岁嘛，就是应该搞点事情的年龄。”嗯，如果说我有点不好意思，那更多的可能是一种对自己的失望的感觉吧。毕竟，我就像越活越走回头路了一般，现在的我，反而觉得这事是应该发生的了。抑或说，我的逻辑由于对自己的偏袒而充分畸形：我对自己说“这只是幻想”，因此不因其而努力；我又对自己说“这是现实”，因而沾沾自喜，感觉自己好厉害。</p>
<p>想想以此为主题，我也写过一些东西了。在已经尸骨无存的旧博客里，在之前夜行的文章里，我都表达过对这种幻想的态度：无用，百害无一利。事实上，夜行之后的一段日子里，我还真的有认真地回避自己幻想的企图，不过发现空下的80%的清醒时间如果都用来想现实问题的话，要么太累，要么控制不好自己的情绪（无形甩锅给现实问题），所以又对自己说“没办法啊”，同时重操旧业起来。今天赶在17岁的最后一天，对自己的态度相比之下已是柔和得多，写这篇文章的原因也是由于一点点无法避免的人类情怀而已。</p>
<hr>
<p>值此……嗯，我没有总结过去的习惯，辉煌就在那里，一眼就能看见用不着总结；我也没有展望未来的习惯……或者说我一天到晚都在展望未来，咳咳。出门买夜宵的路上，我想“18岁了，在此之际，开始好好努力吧”，然而我就像千千万万的同龄人一样，对自己这样的决心一万个不信任。不同的是，我自认为清楚自己立了决心而做不到的原因，那就是幻想。这东西深入我的大脑皮层，已超乎我理解能力的程度影响着我的思考和判断，最终阻碍着我变成一个更好的人。因此，18岁，我没有任何更多的目标，我只希望自己能干掉幻想带来的坏处，上一个台阶看这个世界。嗯，我都不指望干掉幻想本身了，能与之和睦相处，我就心满意足了。</p>
<p>也许做一个纯粹的人可以一定程度上避免幻想的副作用吧。最近写好的Try2048无论怎么看都是一个可喜的里程碑——不仅仅是长久以来第一件带给我成就感的作品，更因为我在完成其的过程中表现出与以往截然不同的行为模式：不再追求快和完成度，精雕细琢，而且长时间的全身心投入其上。综合前因后果，我把其原因归结为重装系统后开始的“纯粹化”进程：不像大多数情况那样为自己营造一个最舒适的工作环境，而是坚持让其最简单化。仿佛在一定程度上折磨了自己，但是心里很清楚任何拉低工作效率的障碍都已扫清。也许这就是好的工作方式，也许这就是好的开始吧。借着生日我决定再立一次Flag，说一句自己最讨厌的话——希望生日的加成能帮助我。我要脱离幻想的桎梏，到达真正的彼岸。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;到明天为止，我就要满18岁了。&lt;/p&gt;
&lt;p&gt;回顾一下自己曾经默默立下的Flag，除去那些极偶尔的，或已经忘却或已经离我远去的幻想，每个梦境，最晚都截止于18岁吧。&lt;/p&gt;
&lt;p&gt;这和中二病的症状倒是很相似，除了一个幻想自己已经是什么，而一个幻想自己将要做且做成什么（本人是后者），已经——作为一个耿直的人，我不介意回顾这些所谓黑历史的存在，毕竟，“我”总共就这么多，仅仅因为个人审美就要扔掉一部分，实在是太浪费了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>多年后终于（开始）完成的夙愿——2048</title>
    <link href="https://oziroe.github.io/2017/08/01/%E5%A4%9A%E5%B9%B4%E5%90%8E%E7%BB%88%E4%BA%8E%EF%BC%88%E5%BC%80%E5%A7%8B%EF%BC%89%E5%AE%8C%E6%88%90%E7%9A%84%E5%A4%99%E6%84%BF%E2%80%94%E2%80%942048/"/>
    <id>https://oziroe.github.io/2017/08/01/多年后终于（开始）完成的夙愿——2048/</id>
    <published>2017-07-31T21:35:59.000Z</published>
    <updated>2017-08-07T10:19:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>嗯，我想写一个2048已经好久好久了……</p>
<blockquote>
<p>人蠢是一种怎样的体验？<br>连个2048都不会写。</p>
</blockquote>
<p><img src="/images/2048运行截图.png" alt="懒得上色的2048"></p>
<a id="more"></a>
<p>当然啦，我说的2048一定是指带动画的版本，静态的我早就写过了。“写个动画有什么难的？”我在动手写之前也是这么想的，后来发现这背后的问题大了……不过在此之前，我们先明确一下2048的规则。</p>
<h1 id="一群2们究竟是怎么合成一个2048的"><a href="#一群2们究竟是怎么合成一个2048的" class="headerlink" title="一群2们究竟是怎么合成一个2048的"></a>一群2们究竟是怎么合成一个2048的</h1><p>一个简单的问题：一行四个2，为什么合成的是两个4，不是一个8或者一个4+两个2？</p>
<p>在2048中，一次滑动之后，要经过以下的步骤：</p>
<ol>
<li>按照滑动的方向把数字分为四列，每列之间互不干涉。</li>
<li>按照滑动的方向把各数字标号，手指轨迹指向的方向为“大端”，从大端开始分别标号为1，2，3，4。</li>
<li>从2号数字开始，称为当前数字，执行以下的步骤<ol>
<li>查看当前数字前面的一个位置；</li>
<li>若该位置被标记为“已合并”，则当前数字停在该位置之后的一个位置上；</li>
<li>若该位置上有数字，则若该数字与当前数字一样，就将当前数字合并到该位置上，并将该位置标记为“已合并”；否则，将当前数字移动到该位置之后的一个位置上；</li>
<li>若该位置没有数字，则继续看该位置之前的一个位置，并重复以上步骤；若一直看到1号位置都没有数字，则将当前数字移动到1号位置上。</li>
</ol>
</li>
</ol>
<p>以上的步骤对每列的数字顺次执行，即前一个数字操作完了后一个数字再开始，当所有数字都操作完时这次滑动的效果全部完成。如果在整个过程中没有任何一个数字的位置或大小发生变化，则认为这是一个无效操作；否则在空格区域随机添加一个数字，位置完全随机，数字有十分之一的概率是4，其余是2。开局的两个数字与此一致。</p>
<hr>
<p>经过上面的一番长篇大论，大致可以看出，操作的基本单位是数字，而基本操作有三种：移动，合并和新增。其中合并是指一个数字不动，另一个数字移动到其位置与之合并，该操作又可以分为两步：先移动，然后目的地的数字替换为加倍的数字。为什么要把合并拆开看？仔细观察2048游戏界面就会发现，每次滑动过后的动画，是按照移动、合并和新增的顺序进行的，只有所有的移动动画全部结束以后（无论是单纯的移动还是合并的前半部分），才会开始合并的动画。到这里，为什么动画难实现的回答也有了一半：所有的操作不能按照算法的顺序直接作用在局面上，要先存起来，整理好顺序才能执行。</p>
<p>而另一半原因则是这三种操作本身的区别：移动和替换都是针对一个数字，而新增则是从无到有；移动时，两个数字可能会移动到同一个位置上。按照一般的思路……算了我已经把一般的思路忘得差不多了。接下来就是Try2048登场的时间了。</p>
<hr>
<p>相比起2048的“官方”<a href="https://github.com/gabrielecirulli/2048" target="_blank" rel="external">实现</a>，这应该算是一个超级短小的程序，目前还没有500行，因此没有分散在多个文件里，预期就是让读者可以一口气看到低——记得当初实在写不出去看官方版本的时候，还没有看懂那些现在看来连设计模式都算不上的封装就已经被吓跑了，真是怀念啊。写代码的思路基本是分层，然后由下至上的实现，因此本文也采取这样的顺序。</p>
<p>最底层并不是画界面，我认为这个层面可以慢慢写，所以首先抽象了三个基本操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Advent</span>(<span class="params">x, y, number, finished</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Number "</span> + number + <span class="string">" appears at "</span> + StringP(x, y));</div><div class="line">    DisplayAdvent(x, y, number, finished);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Move</span>(<span class="params">x, y, newX, newY, finished</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"The number at "</span> + StringP(x, y) + <span class="string">" is now at "</span> +</div><div class="line">        StringP(newX, newY));</div><div class="line">    DisplayMove(x, y, newX, newY, finished);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Substitute</span>(<span class="params">x, y, number, finished</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"The number at "</span> + StringP(x, y) + <span class="string">" is now changed to "</span> +</div><div class="line">        number);</div><div class="line">    DisplaySubstitute(x, y, number, finished);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样做之后给自己带来了一些小小的麻烦，下文中会详细讲到。可以看到，函数体原本只有一行log，后来写好了底层才对接了上来。接受的参数中<code>finished</code>是一个不带参数的回调函数，调用它即意味着当前基本操作完成了。是的，这些接口都会在动画执行之前就返回，因此需要这个参数确定确切的完成时间。原本只打印log的时候<code>finished</code>就直接就地调用了，现在则需要传下去。</p>
<p>有了基本操作的表示以后，进入到最复杂也是最重要的一个抽象层次：<code>Turn</code>。它代表着一次滑动所触发的所有基本操作的集合，对上层提供的接口除了向集合中添加基本操作外，还有一个<code>Trigger</code>函数，在执行时会按照上文所述的顺序执行所有的基本操作，并且等待一类基本操作都执行完了再执行下一类，它还可以携带一些钩子函数，在合适的时机触发它们。首先是内部数据结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Turn</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">this</span>._actions = &#123;<span class="attr">advent</span>: [], <span class="attr">move</span>: [], <span class="attr">substitute</span>: []&#125;;</div><div class="line">    <span class="keyword">this</span>._remain  = &#123;<span class="attr">advent</span>: <span class="number">0</span>, <span class="attr">move</span>: <span class="number">0</span>, <span class="attr">substitute</span>: <span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中<code>_actions</code>存了每种基本操作的每一个操作的调用参数，比如<code>advent</code>中的元素形式为<code>{x, y, number}</code>，与上面的接口相对应，而<code>_remain</code>中则是每种基本操作的剩余个数。</p>
<p>接下来是向<code>Turn</code>中添加操作的接口：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.Advent = <span class="function"><span class="keyword">function</span>(<span class="params">x, y, number</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    self._remain.advent++;</div><div class="line">    self._actions.advent.push(&#123;<span class="attr">x</span>: x, <span class="attr">y</span>: y, <span class="attr">number</span>: number&#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">this</span>.Move = <span class="function"><span class="keyword">function</span>(<span class="params">x, y, newX, newY</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    self._remain.move++;</div><div class="line">    self._actions.move.push(&#123;<span class="attr">x1</span>: x, <span class="attr">y1</span>: y, <span class="attr">x2</span>: newX, <span class="attr">y2</span>: newY&#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">this</span>.Merge = <span class="function"><span class="keyword">function</span>(<span class="params">x, y, toX, toY, number</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    self.Move(x, y, toX, toY);</div><div class="line">    self._remain.substitute++;</div><div class="line">    self._actions.substitute.push(&#123;<span class="attr">x</span>: toX, <span class="attr">y</span>: toY, <span class="attr">number</span>: number * <span class="number">2</span>&#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>其中，<code>Merge</code>在该层被抽象出来，上层将可以使用真正需要的三个接口进行调用。接下来的<code>Trigger</code>函数……做好心理准备：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.Trigger = <span class="function"><span class="keyword">function</span>(<span class="params">afterMove=null, afterAdvent=null</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">CommonPatternHere</span>(<span class="params">dataSet, call, decrease, beforeNext,</span></span></div><div class="line"><span class="function"><span class="params">        after</span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line"><span class="function">        </span>&#123;</div><div class="line">            <span class="keyword">if</span> (dataSet.length === <span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line">                after();</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">while</span> (dataSet.length &gt; <span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">var</span> data = dataSet.pop();</div><div class="line">                call(data, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line"><span class="function">                </span>&#123;</div><div class="line">                    <span class="comment">// It is heard that in Javascript there's no data race.</span></div><div class="line">                    <span class="comment">// The following code need fix if I was wrong.</span></div><div class="line">                    <span class="comment">// `decrease` will change count value and return its new</span></div><div class="line">                    <span class="comment">// value. It must be wrapped to change the origin var.</span></div><div class="line">                    <span class="keyword">if</span> (decrease() === <span class="number">0</span>)</div><div class="line">                    &#123;</div><div class="line">                        <span class="keyword">if</span> (beforeNext !== <span class="literal">null</span>)</div><div class="line">                            beforeNext();</div><div class="line">                        after();</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上是该函数的第一部分。由于对于三种基本操作的处理方法基本一致，因此抽象出一个pattern。整个思路还算清晰，有点别扭的大概就是上面的<code>decrease</code>了，这是因为原本调用是用的<code>self._remain.advent</code>之类，后来发现不行，因此基本类型是传值调用的，于是改成<code>{value: self._remain.advent}</code>，结果还是不行，因为保留更改的只是这个匿名对象里的值，而从<code>self._remain.advent</code>到这个匿名对象还是复制了……所以接下来如果看到这种东西：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> --self._remain.advent; &#125;</div></pre></td></tr></table></figure>
<p>希望你能体会我的无奈。</p>
<p>哦你说为啥参数里没有<code>afterMerge</code>？这不是赤裸裸的歧视吗？一方面我还没想好怎么把它对接到替换上去，另一方面……其实这俩也是因为用上了才慢慢加上的，<code>afterMerge</code>？没有这种需求，当然就没有啦。</p>
<p>看完第一部分我想你已经猜到了接下来怎么调用它，不过也许你发现了一些不得了的东西：为什么这个函数要返回一个匿名函数？这不是多此一举吗？如果我告诉你这是为了保持和<code>after</code>参数形式的一致性，我想你大概能预感到一些可怕的事情了。没错，我遵循那个著名的信条：</p>
<blockquote>
<p>嵌套回调函数是丑陋的。</p>
</blockquote>
<p>原话大概还包含了对其的一个形象的比喻，不过被我忘记了。总之，作为嵌套回调转化为链式的准备步骤，就有了接下来的第二部分：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">CurryList</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">this</span>._list = [];</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">this</span>.Call = <span class="function"><span class="keyword">function</span>(<span class="params">dataSet, call, decrease,</span></span></div><div class="line"><span class="function"><span class="params">        beforeNext=null</span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        self._list.push(&#123;<span class="attr">dataSet</span>: dataSet, <span class="attr">call</span>: call,</div><div class="line">            decrease: decrease, <span class="attr">beforeNext</span>: beforeNext&#125;);</div><div class="line">        <span class="keyword">return</span> self;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">this</span>.List = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> self._list.map(<span class="function"><span class="keyword">function</span>(<span class="params">argument</span>)</span></div><div class="line"><span class="function">        </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">after</span>)</span></div><div class="line"><span class="function">            </span>&#123;</div><div class="line">                <span class="keyword">return</span> CommonPatternHere(argument.dataSet,</div><div class="line">                    argument.call, argument.decrease,</div><div class="line">                    argument.beforeNext, after);</div><div class="line">            &#125;;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可惜我当时脑子不太好使，不然应该可以写出一个不需要缓存参数的版本。现在……脑子更不好使了，就当没看见吧。从嵌套到平铺的一个关键问题就是没有<code>after</code>，因此首先对各个函数调用进行科里化，延缓其对<code>after</code>的需求。最后，第三部分包含了套参数和组装的过程：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> CurryList()</div><div class="line">.Call(self._actions.move,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">move, finished</span>) </span>&#123;</div><div class="line">        Move(move.x1, move.y1, move.x2, move.y2, finished);</div><div class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// I want pointer!</span></div><div class="line">        <span class="keyword">return</span> --self._remain.move;</div><div class="line">    &#125;, afterMove)</div><div class="line">.Call(self._actions.substitute,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">sub, finished</span>) </span>&#123;</div><div class="line">        Substitute(sub.x, sub.y, sub.number, finished);</div><div class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> --self._remain.substitute;</div><div class="line">    &#125;)</div><div class="line">.Call(self._actions.advent,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">advent, finished</span>) </span>&#123;</div><div class="line">        Advent(advent.x, advent.y, advent.number, finished);</div><div class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> --self._remain.advent;</div><div class="line">    &#125;, afterAdvent)</div><div class="line">.List().reduceRight(</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">after, previous</span>) </span>&#123; <span class="keyword">return</span> previous(after); &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"All done for this turn."</span>); &#125;)();</div></pre></td></tr></table></figure>
<p>使用<code>reduceRight</code>就可以按照自然顺序进行链式调用了（“在<code>CurryList</code>里不能处理吗？”“听不见听不见……”），顺便你会发现在接口层当中预留的<code>finished</code>函数其实就是上面第一部分中定义的，基本逻辑是给计数器减一，到0就调用<code>after</code>开始下一阶段。<code>afterXXX</code>也都被安排到了合理的位置上。</p>
<p>顺便一说写到<code>reduceRight</code>的时候我突然想起对IE的兼容性问题，于是万念俱灰的用IE11打开这个页面，没想到在去掉了默认参数和<code>Array.fill</code>以后居然正确的运行了！这一刻我的喜悦和程序刚刚跑通时相比有增无减。</p>
<hr>
<p>下一个抽象层次是<code>Grid</code>，它代表一张棋盘。在这里，我们终于要迎来喜闻乐见的游戏逻辑，而在此之前，问自己一个问题：如何避免把同样的代码写四遍？官方实现用的方法非常精巧，而我就笨拙得多了。进入主题前先看看内部数据结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Grid</span>(<span class="params">size</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">this</span>._grid = <span class="keyword">new</span> <span class="built_in">Array</span>(size);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>._grid.length; i++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>._grid[i] = <span class="keyword">new</span> <span class="built_in">Array</span>(size);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="keyword">this</span>._grid[i].length; j++)</div><div class="line">            <span class="keyword">this</span>._grid[i][j] = <span class="number">0</span>;  <span class="comment">// 0 means no number here.</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个简单的二维数组，因为去掉了<code>Array.fill</code>所以显得有些啰嗦，不过倒是有点像我上一篇文章里说的，有点C程序的感觉了，只是现在……我谢天谢地它不是用C写的。跳过生成随机数字的函数，首先来看<code>Slide</code>的第一部分：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// `direction`: 0 =&gt; up, 1 =&gt; right, 2 =&gt; down, 3 =&gt; left.</span></div><div class="line"><span class="keyword">this</span>.Slide = <span class="function"><span class="keyword">function</span>(<span class="params">direction, turn</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="comment">// Slide `numbers` toward numbers[0].</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">SlideVector</span>(<span class="params">numbers, move, merge</span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">var</span> merged = <span class="keyword">new</span> <span class="built_in">Array</span>(size);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; merged.length; i++)</div><div class="line">            merged[i] = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">var</span> changed = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; size; i++)  <span class="comment">// First number stays.</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (numbers[i] === <span class="number">0</span>)</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (merged[j])  <span class="comment">// Merged number will not be modified again.</span></div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">if</span> (j + <span class="number">1</span> !== i)</div><div class="line">                    &#123;</div><div class="line">                        changed = <span class="literal">true</span>;</div><div class="line">                        move(i, j + <span class="number">1</span>);</div><div class="line">                        numbers[j + <span class="number">1</span>] = numbers[i];</div><div class="line">                        numbers[i] = <span class="number">0</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (numbers[j] !== <span class="number">0</span>)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">if</span> (numbers[j] === numbers[i])  <span class="comment">// Merge same numbers.</span></div><div class="line">                    &#123;</div><div class="line">                        changed = <span class="literal">true</span>;</div><div class="line">                        merge(i, j, numbers[i]);</div><div class="line">                        merged[j] = <span class="literal">true</span>;</div><div class="line">                        numbers[j] += numbers[i];</div><div class="line">                        numbers[i] = <span class="number">0</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">else</span>  <span class="comment">// Move to neighbour.</span></div><div class="line">                    &#123;</div><div class="line">                        <span class="keyword">if</span> (j + <span class="number">1</span> !== i)</div><div class="line">                        &#123;</div><div class="line">                            changed = <span class="literal">true</span>;</div><div class="line">                            move(i, j + <span class="number">1</span>);</div><div class="line">                            numbers[j + <span class="number">1</span>] = numbers[i];</div><div class="line">                            numbers[i] = <span class="number">0</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (j === <span class="number">0</span>)  <span class="comment">// Stop moving on the edge.</span></div><div class="line">                &#123;</div><div class="line">                    changed = <span class="literal">true</span>;</div><div class="line">                    move(i, <span class="number">0</span>);</div><div class="line">                    numbers[<span class="number">0</span>] = numbers[i];</div><div class="line">                    numbers[i] = <span class="number">0</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> changed;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>这个子函数的功能是把一列数向着它的首元素方向“滑动”，逻辑基本就是上文的复述。这里主要注意的是移动数字以后对于“是否改变”的判定，要把“原地移动”的情况排除掉。想来这个函数功能的简单出乎各位看官的预料，那么更多的功能显然交给调用方了。大家等不及看四遍重复的代码了吧？然而，还真没有……</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> UP = <span class="number">0</span>, RIGHT = <span class="number">1</span>, DOWN = <span class="number">2</span>, LEFT = <span class="number">3</span>;</div><div class="line"><span class="keyword">var</span> changed = <span class="literal">false</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> first = <span class="number">0</span>; first &lt; size; first++)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">var</span> numbers = <span class="keyword">new</span> <span class="built_in">Array</span>(size), iX = <span class="keyword">new</span> <span class="built_in">Array</span>(size),</div><div class="line">        iY = <span class="keyword">new</span> <span class="built_in">Array</span>(size);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> second = <span class="number">0</span>; second &lt; size; second++)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> sec = direction === UP || direction === LEFT ? second :</div><div class="line">            size - second - <span class="number">1</span>;</div><div class="line">        <span class="comment">// I hate 80 ruler.</span></div><div class="line">        iX[second] =</div><div class="line">            direction === UP || direction === DOWN ? first : sec;</div><div class="line">        iY[second] =</div><div class="line">            direction === UP || direction === DOWN ? sec : first;</div><div class="line">        <span class="comment">// console.log(second + " " + StringP(iX[second], iY[second]));</span></div><div class="line">        numbers[second] = self._grid[iX[second]][iY[second]];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// It's a little breaking my rule to put left brace on the same line</span></div><div class="line">    <span class="comment">// of previous code, but it seems too ugly otherwise.</span></div><div class="line">    <span class="keyword">var</span> c = SlideVector(numbers, <span class="function"><span class="keyword">function</span>(<span class="params">from, to</span>) </span>&#123;</div><div class="line">        turn.Move(iX[<span class="keyword">from</span>], iY[<span class="keyword">from</span>], iX[to], iY[to]);</div><div class="line">        self._grid[iX[to]][iY[to]] = self._grid[iX[<span class="keyword">from</span>]][iY[<span class="keyword">from</span>]];</div><div class="line">        self._grid[iX[<span class="keyword">from</span>]][iY[<span class="keyword">from</span>]] = <span class="number">0</span>;</div><div class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">from, to, number</span>) </span>&#123;</div><div class="line">        turn.Merge(iX[<span class="keyword">from</span>], iY[<span class="keyword">from</span>], iX[to], iY[to], number);</div><div class="line">        self._grid[iX[to]][iY[to]] += self._grid[iX[<span class="keyword">from</span>]][iY[<span class="keyword">from</span>]];</div><div class="line">        self._grid[iX[<span class="keyword">from</span>]][iY[<span class="keyword">from</span>]] = <span class="number">0</span>;</div><div class="line">    &#125;);</div><div class="line">    changed = c ? <span class="literal">true</span> : changed;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (changed)</div><div class="line">    self.AddRandom(turn);</div><div class="line"><span class="keyword">return</span> changed;</div></pre></td></tr></table></figure>
<p>在对不同的情况把<code>numbers</code>当中的数排好顺序的同时，填好<code>iX</code>和<code>iY</code>两个数组，作为两个平行数组分别储存<code>numbers</code>中各元素的x和y坐标。在<code>SlideVector</code>中使用的<code>move</code>和<code>merge</code>也在此处被包装好，提供足够的信息去调用下层的接口。在此之后，<code>Grid</code>当中还有一个判断游戏是否结束的函数，主要检查两件事：还有没有空位，以及有没有相邻的相同元素，符合任何一个条件都还是活局，否则就死了。</p>
<p>以上两个层次作为这篇代码的精华，也是最华而不实的部分……如果把其中为了形式美观做的抽象（科里化、<code>SlideVector</code>子函数等）都去掉，再把所有的左大括号拿到上一行去（做梦吧），这篇代码也许就只剩300多行了。</p>
<hr>
<p>接下来是组装前的最后一个步骤：画界面层。在这里我就遇到了之前给自己挖的坑：接口层留的三个基本接口实在是太“纯粹”了，它们都是无状态的接口，不能在两次调用之间留存任何信息。而偏偏图形层就需要一些信息：比如说前一个调用创建了一个数字，后一个调用去移动它的时候，得先在DOM树上把它找回来。之前采用id来标识，就会遇到两个数字移动到同一个位置的尴尬局面。最后先妥协了一下，用了全局变量，之后尽量把它改过来，先凑合着看吧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Display Part.</span></div><div class="line"><span class="comment">// This is the base of a more complicated implementation of interfaces.</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DisplayInitialize</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">var</span> container = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">    container.id = <span class="string">"board-tiles-container"</span>;</div><div class="line">    container.style.width = container.style.height = <span class="string">"450px"</span>;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"board-container"</span>).appendChild(container);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> searchTable = <span class="keyword">new</span> <span class="built_in">Object</span>, registryTable = <span class="keyword">new</span> <span class="built_in">Object</span>, deadQueue = <span class="keyword">new</span> <span class="built_in">Array</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DisplayAdvent</span>(<span class="params">x, y, number, finished</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">var</span> tile = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</div><div class="line">    tile.innerText = number;</div><div class="line">    tile.classList.add(<span class="string">"board-tile"</span>);</div><div class="line">    tile.style.transition = <span class="string">"all 0.05s"</span>;</div><div class="line">    tile.style.width = tile.style.height = <span class="number">0</span>;</div><div class="line">    tile.style.lineHeight = <span class="string">"100px"</span>;</div><div class="line">    tile.style.fontSize = <span class="number">0</span>;</div><div class="line">    tile.style.margin = <span class="string">"50px"</span>;</div><div class="line">    tile.style.top  = (y * <span class="number">110</span> + <span class="number">10</span>) + <span class="string">"px"</span>;</div><div class="line">    tile.style.left = (x * <span class="number">110</span> + <span class="number">10</span>) + <span class="string">"px"</span>;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"board-tiles-container"</span>).appendChild(tile);</div><div class="line">    searchTable[StringP(x, y)] = tile;</div><div class="line"></div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        tile.style.width = tile.style.height = <span class="string">"100px"</span>;</div><div class="line">        tile.style.fontSize = <span class="string">"20px"</span>;</div><div class="line">        tile.style.margin = <span class="string">""</span>;</div><div class="line">    &#125;, <span class="number">0</span>);</div><div class="line">    OnceListener(tile, finished);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DisplayMove</span>(<span class="params">x, y, newX, newY, finished</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">var</span> tile = searchTable[StringP(x, y)];</div><div class="line">    tile.style.transition = <span class="string">"all 0.2s"</span>;</div><div class="line">    tile.style.top  = (newY * <span class="number">110</span> + <span class="number">10</span>) + <span class="string">"px"</span>;</div><div class="line">    tile.style.left = (newX * <span class="number">110</span> + <span class="number">10</span>) + <span class="string">"px"</span>;</div><div class="line">    <span class="comment">// There's no need to worry about overriding.</span></div><div class="line">    <span class="comment">// Any override tile will be override again by substitution.</span></div><div class="line">    <span class="comment">// So any of them survives will be okay.</span></div><div class="line">    <span class="keyword">if</span> (registryTable[StringP(newX, newY)] !== <span class="literal">undefined</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> dead = registryTable[StringP(newX, newY)];</div><div class="line">        deadQueue.push(dead);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> searchTable[StringP(x, y)];</div><div class="line">    registryTable[StringP(newX, newY)] = tile;</div><div class="line">    OnceListener(tile, finished);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DisplayAfterMove</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">while</span> (deadQueue.length &gt; <span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> dead = deadQueue.pop();</div><div class="line">        dead.parentElement.removeChild(dead);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">Object</span>.keys(registryTable).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">pos</span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span> (searchTable[pos] !== <span class="literal">undefined</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">var</span> dead = searchTable[pos];</div><div class="line">            dead.parentElement.removeChild(dead);</div><div class="line">        &#125;</div><div class="line">        searchTable[pos] = registryTable[pos];</div><div class="line">    &#125;);</div><div class="line">    registryTable = <span class="keyword">new</span> <span class="built_in">Object</span>;</div><div class="line">    <span class="comment">// console.log(searchTable);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DisplaySubstitute</span>(<span class="params">x, y, num, finished</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">var</span> tile = searchTable[StringP(x, y)];</div><div class="line">    tile.innerText = num;</div><div class="line">    tile.style.transition = <span class="string">"all 0.1s"</span>;</div><div class="line">    tile.style.width = tile.style.height = tile.style.lineHeight = <span class="string">"110px"</span>;</div><div class="line">    tile.style.fontSize = <span class="string">"22px"</span>;</div><div class="line">    tile.style.margin = <span class="string">"-5px"</span>;</div><div class="line">    OnceListener(tile, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        tile.style.width = tile.style.height = tile.style.lineHeight = <span class="string">"100px"</span>;</div><div class="line">        tile.style.fontSize = <span class="string">"20px"</span>;</div><div class="line">        tile.style.margin = <span class="string">""</span>;</div><div class="line">        OnceListener(tile, finished);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中还有大量的常数，之后会抽到配置当中去。这里的三个全局（列）表都是为<code>DisplayMove</code>服务的，在一个<code>Turn</code>的周期内，所有的数字以如下的方式在这三个表中流窜：</p>
<ul>
<li>最初，所有数字都在<code>searchTable</code>里；</li>
<li>移动阶段，每个数字移动的同时，把自己注册到<code>registryTable</code>的对应位置上，如果遇到两个数字都移动且终点相同的情况则后来者会覆盖先到者，并把它转移到<code>deadQueue</code>里面去。（这里谁去谁留没有区别，因为这种情况之后一定会对应一个替换步骤，所以……谁都活不了）</li>
<li>移动结束阶段，首先<code>deadQueue</code>里的数字被清除掉，然后<code>registryTable</code>里的数字转移回<code>searchTable</code>里，如果转移回来的时候发现对应的格子里已经有数字了，说明这是一个数字移动到另一个静止数字位置上的情况，则静止数字被清除，由新来的数字填补。</li>
<li>接下来的时间里，大家都一直呆在<code>searchTable</code>里，直到下一个移动阶段到来。</li>
</ul>
<p>这里的一个要点就是一定要到移动结束阶段（对应于<code>DisplayAfterMove</code>函数）才可以开始清理重叠的数字，对于静止的数字，这是为了防止格子上的数字突然消失吓到小朋友；对于两个数字都移动的情况，别忘了它们身上还有一个<code>finished</code>呢，这个函数的调用时机是<code>transitionend</code>事件（比手动<code>setTimeout</code>高端多了），如果提前清掉了移动阶段就再也结束不了了。这几个方法的结尾都有一个<code>OnceListener</code>函数的调用，这个函数会给元素添加一个绑定在<code>transitionend</code>事件上的一次性回调函数，触发了就被移除，避免与下一个<code>finished</code>弄混。</p>
<p>此外，<code>DisplayAdvent</code>要实现的动画效果是从中心一个点开始扩大，要把设置其样式为正常值的部分放在<code>setTimeout(..., 0)</code>的里面，这样可以避免与前面的DOM操作合并，动画没了是小事，触发不了<code>transitionend</code>可就坏了。</p>
<p>最后，<code>DisplaySubstitute</code>（感谢这个程序终于让我记熟了这个词的拼写）的效果是先变大一圈再变小。你问我为什么不写成链式的了？懒啊！</p>
<hr>
<p>好了，最后终于来到了主函数部分：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Main Part.</span></div><div class="line"><span class="comment">// The main game loop and entry point.</span></div><div class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    DisplayInitialize();</div><div class="line">    <span class="keyword">var</span> turn = <span class="keyword">new</span> Turn();</div><div class="line">    <span class="keyword">var</span> grid = <span class="keyword">new</span> Grid(<span class="number">4</span>);</div><div class="line">    grid.AddRandom(turn);</div><div class="line">    grid.AddRandom(turn);</div><div class="line">    turn.Trigger();</div><div class="line">    <span class="comment">// console.log(grid);</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> animating = <span class="literal">false</span>, over = <span class="literal">false</span>;</div><div class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"keypress"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="comment">// Disable key press during animation.</span></div><div class="line">        <span class="keyword">if</span> (animating || over)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">var</span> map = &#123;<span class="attr">w</span>: <span class="number">0</span>, <span class="attr">d</span>: <span class="number">1</span>, <span class="attr">s</span>: <span class="number">2</span>, <span class="attr">a</span>: <span class="number">3</span>&#125;;</div><div class="line">        <span class="keyword">if</span> (e.key <span class="keyword">in</span> map)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (grid.Slide(map[e.key], turn))</div><div class="line">            &#123;</div><div class="line">                animating = <span class="literal">true</span>;</div><div class="line">                turn.Trigger(DisplayAfterMove, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    animating = <span class="literal">false</span>;</div><div class="line">                    <span class="built_in">console</span>.log(StringG(grid));</div><div class="line">                    <span class="keyword">if</span> (grid.Over())</div><div class="line">                    &#123;</div><div class="line">                        <span class="built_in">console</span>.log(<span class="string">"Game Over"</span>);</div><div class="line">                        over = <span class="literal">true</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// console.log(searchTable);</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>大部分逻辑都一目了然了。其中<code>animating</code>是为了在动画过程中屏蔽按键（虽然除非你是故意瞎滑也不可能那么快做出判断），而“Game Over”的界面不仅仅是没有加入到真正的页面上，甚至没有完成其正确性测试……每一局都因为各种奇奇怪怪的原因流产了……最后一次是在IE11上，我把它的console调出来看看输出，然后键盘操作就不好使了……什么龟。</p>
<hr>
<p>感觉就像讲了一生的故事一样，这份代码经过几次推倒重来，虽然最终版只用了小半天时间，但算是近很长一段时间以来唯一一个算是完整的作品。当然啦，只能叫“算是”，毕竟这份代码的最终目的——帮我玩出4096，还一点都没开始呢。</p>
<p>项目地址：<a href="https://github.com/oziroe/try-2048" target="_blank" rel="external">try-2048</a>，欢迎丢星星。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嗯，我想写一个2048已经好久好久了……&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;人蠢是一种怎样的体验？&lt;br&gt;连个2048都不会写。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/images/2048运行截图.png&quot; alt=&quot;懒得上色的2048&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="https://oziroe.github.io/tags/javascript/"/>
    
      <category term="2048" scheme="https://oziroe.github.io/tags/2048/"/>
    
      <category term="Try2048" scheme="https://oziroe.github.io/tags/Try2048/"/>
    
      <category term="函数式编程" scheme="https://oziroe.github.io/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>突然回忆的过往之事</title>
    <link href="https://oziroe.github.io/2017/07/30/%E7%AA%81%E7%84%B6%E5%9B%9E%E5%BF%86%E7%9A%84%E8%BF%87%E5%BE%80%E4%B9%8B%E4%BA%8B/"/>
    <id>https://oziroe.github.io/2017/07/30/突然回忆的过往之事/</id>
    <published>2017-07-30T05:16:07.000Z</published>
    <updated>2017-07-30T05:39:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>重新安装了系统，出于某种……我自己也难以理解的洁癖不想在macOS底下装中文输入法，然而要我在Windows底下配置博客环境还不如直接杀了我，于是这篇文章变成了这样……</p>
<p><img src="/images/记事本博客截图.PNG" alt="这篇博客现在的样子……"></p>
<p>在此再复述一遍早就挖好的坑：</p>
<blockquote>
<p>一个可以全平台使用（尤其是Windows）的博客客户端</p>
</blockquote>
<p>再不勤奋一点我自甘日狗。</p>
<a id="more"></a>
<p>一个人的寝室，虽然不想承认，但还是有些落寞。整个人也不自觉的更勤奋了一些以转移注意力。上午区区两个小时，就写出了一个2048游戏的核心逻辑，不知道两年前死活写不出的我若是知晓会怎么想。唉……傻逼，谁让你不会用函数作抽象。不过这个javascript代码看着就是很奇怪……它仿佛用尽自己的力气在呐喊：“老子是C！把老子的拓展名改回来！”也许十年前的js我的风格会是主流吧，现在只能叫泥石流了。</p>
<p>等这个项目完工了会上传GitHub。（谁在挖坑？）</p>
<hr>
<p>多年前的一个暑假，我沉迷玩滑板，先是两脚一个板的蛇板，后来是换了一脚一个的，父亲就玩起了旧板陪我。夕阳之下，一大群小孩子里混杂着一个大人笨拙着，现在想起来要很大的勇气吧。</p>
<p>有一天我和一群孩子在比试谁能滑上人行道，我玩的双板显然不可能，于是我借了一个孩子的单板，临到人行道时一个交叉后踢腿，人跑到一边，但是板子会飞上人行道。</p>
<p>这大概是一种非常暴力的动作，借我板子的小孩沉着脸让我把板还给他，我不听，又试了一次。这次围过来的人有点多。过了好大一会我才明白异常所在：我把那孩子的板玩成了两截。</p>
<p>我慌了，意料之外的情况不知如何处理。父亲走过去商量了一下，回来说，他把旧板赔给那个孩子了。</p>
<p>“那你滑什么？”话没问出口就被我吞了回去。这不是那时的我会做的事。</p>
<p>我突然感到一阵心痛。那时的我，性格顽劣。这是我第一次因为意识到自己的过错所付出代价的沉重而心痛。</p>
<p>不过，要想看到我彻底明白什么才是责任，还要等上好多年。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;重新安装了系统，出于某种……我自己也难以理解的洁癖不想在macOS底下装中文输入法，然而要我在Windows底下配置博客环境还不如直接杀了我，于是这篇文章变成了这样……&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/记事本博客截图.PNG&quot; alt=&quot;这篇博客现在的样子……&quot;&gt;&lt;/p&gt;
&lt;p&gt;在此再复述一遍早就挖好的坑：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;一个可以全平台使用（尤其是Windows）的博客客户端&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;再不勤奋一点我自甘日狗。&lt;/p&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
      <category term="破事水" scheme="https://oziroe.github.io/tags/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
  </entry>
  
  <entry>
    <title>在实现oz的路上迈出第一步（避免被认为是死了）</title>
    <link href="https://oziroe.github.io/2017/07/23/%E5%9C%A8%E5%AE%9E%E7%8E%B0oz%E7%9A%84%E8%B7%AF%E4%B8%8A%E8%BF%88%E5%87%BA%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%88%E9%81%BF%E5%85%8D%E8%A2%AB%E8%AE%A4%E4%B8%BA%E6%98%AF%E6%AD%BB%E4%BA%86%EF%BC%89/"/>
    <id>https://oziroe.github.io/2017/07/23/在实现oz的路上迈出第一步（避免被认为是死了）/</id>
    <published>2017-07-23T15:04:24.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>既是指项目，也是指人。</p>
<p>刚刚将所有的提交合并到主分支上，现在<a href="https://github.com/oziroe/oz" target="_blank" rel="external">代码仓库</a>的语言条变得五颜六色了起来。唔，标准的程序员浪漫么。</p>
<a id="more"></a>
<p>首先是有关Makefile的奇技淫巧。Makefile的隐式规则处理lex足够了，但是它不会自动生成yacc的头文件<code>y.tab.h</code>，导致了lex规则中不能用token之类的宏和变量。因此要做三件事：</p>
<ol>
<li>手动添加yacc的参数<code>-d</code>，确保生成头文件</li>
<li>确保yacc的规则在lex的规则之前被处理生成</li>
<li>由于修改了Makefile规则，原来的自动删除中间文件现在没有了，要手动删除</li>
</ol>
<p>最后的成果大概是这样：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="section">all: main</span></div><div class="line">	cp main oz</div><div class="line"></div><div class="line"><span class="section">main: lexical.o grammer.o</span></div><div class="line"><span class="section">lexical.o: grammer.c</span></div><div class="line"><span class="section">grammer.c: YFLAGS += -d</span></div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: clean</span></div><div class="line"><span class="section">clean:</span></div><div class="line">	rm *.o *.tab.h grammer.c main</div></pre></td></tr></table></figure>
<p>其中复制的一步是为了避免重复链接oz（同时还要用隐式规则），又希望上一级的Makefile看到的名字是oz而不是main。没有刻意保持目录的整洁，很多东西留到了clean里面才删，等项目大一些了要考虑重写一下。</p>
<hr>
<p>lex的规则有点奇怪。写成如下这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot; &quot;&#123;OPERATOR_CHARSET1&#125;+/(&quot;(&quot;|[0-9]) &#123; /* ... */ &#125;</div></pre></td></tr></table></figure>
<p>而不是后面括号当中部分的分配率展开形式可以避免报错如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lexical.l:66: warning, trailing context made variable due to preceding &apos;|&apos; action</div><div class="line">lexical.l:66: warning, dangerous trailing context</div></pre></td></tr></table></figure>
<p>（也许）也能避免一些解析错误。原因未知。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;既是指项目，也是指人。&lt;/p&gt;
&lt;p&gt;刚刚将所有的提交合并到主分支上，现在&lt;a href=&quot;https://github.com/oziroe/oz&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;代码仓库&lt;/a&gt;的语言条变得五颜六色了起来。唔，标准的程序员浪漫么。&lt;/p&gt;
    
    </summary>
    
    
      <category term="oz" scheme="https://oziroe.github.io/tags/oz/"/>
    
      <category term="lex" scheme="https://oziroe.github.io/tags/lex/"/>
    
      <category term="yacc" scheme="https://oziroe.github.io/tags/yacc/"/>
    
      <category term="Makefile" scheme="https://oziroe.github.io/tags/Makefile/"/>
    
  </entry>
  
  <entry>
    <title>关于一个新的语言oz的构想</title>
    <link href="https://oziroe.github.io/2017/07/20/%E5%85%B3%E4%BA%8E%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%AF%AD%E8%A8%80oz%E7%9A%84%E6%9E%84%E6%83%B3/"/>
    <id>https://oziroe.github.io/2017/07/20/关于一个新的语言oz的构想/</id>
    <published>2017-07-20T15:49:23.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>新的<a href="https://github.com/oziroe/oz" target="_blank" rel="external">代码仓库</a>已经建立，欢迎捧个人场。实话说，Github的语言条还是让我惊讶了一下。</p>
<p><img src="/images/还有这种操作.png" alt="还有这种操作"></p>
<a id="more"></a>
<p>算是在开发渲染器路上绕的一个大大的圈子吧。不满足于C/C++的使用体验，用Ruby又会因为弱类型而异常痛苦，终于成了压倒骆驼的最后一根稻草。</p>
<p>这门语言的核心目标是：</p>
<blockquote>
<p>存在着与C中一一对应的语言特性。</p>
</blockquote>
<p>这门语言的终极目标是：</p>
<blockquote>
<p>作为一个消歧义的、高于自然语言的存在，在不影响阅读体验的前提下实现所有功能。</p>
</blockquote>
<p>一些已经构思好的特色之处：</p>
<ul>
<li>通过标准库实现结构、对象和一切非核心功能。</li>
<li>对上一条的解释：语法灵活，可以定制语法糖和语言特性。</li>
<li>真正基于约束（而不是绕一个弯子基于类型）的模板。</li>
<li>更加统一和形象的符号使用。</li>
</ul>
<p>好啦，就是什么都没有说。写出点什么再过来写吧。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;新的&lt;a href=&quot;https://github.com/oziroe/oz&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;代码仓库&lt;/a&gt;已经建立，欢迎捧个人场。实话说，Github的语言条还是让我惊讶了一下。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/还有这种操作.png&quot; alt=&quot;还有这种操作&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="oz" scheme="https://oziroe.github.io/tags/oz/"/>
    
      <category term="造轮子" scheme="https://oziroe.github.io/tags/%E9%80%A0%E8%BD%AE%E5%AD%90/"/>
    
  </entry>
  
  <entry>
    <title>夜行记</title>
    <link href="https://oziroe.github.io/2017/07/09/%E5%A4%9C%E8%A1%8C%E8%AE%B0/"/>
    <id>https://oziroe.github.io/2017/07/09/夜行记/</id>
    <published>2017-07-08T23:49:34.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>可不是梦游哦。</p>
<p>PS：西安地铁三号线的声音真是令人惊艳。</p>
<a id="more"></a>
<p><img src="/images/夜行记路线图.png" alt="这些路程大约花了三个小时走完。"></p>
<p>大约凌晨两点的时候从宿舍出发，开始向市中心散步。</p>
<p>夜幕中的城市可不像我想象中的那样平静，哪怕是除去车辆的因素。</p>
<p>少量暴露在空气中的人和我一样用脚步丈量地面；其余的人分成两部分，或者骑各式非机动车（其中共享单车出奇的多），或者待在原地静止不动。</p>
<p>静止不动的人当中，有的人在工作，如道路维修。</p>
<p>有的人在睡觉，身旁的工友在工作。</p>
<p>一个姑娘提着一只行李箱倚在人行道旁的栏杆上，带着哭腔对着电话讲我听不懂的方言。</p>
<p>时不时有三五成群的青壮年，或清醒或不清醒地与我相遇。越接近市中心，看起来越清醒，同时女性占比越高。</p>
<p>到达钟楼转盘道时一辆黄色的法拉利正路过，离开时像电影中一样轰了一脚油门，展示了一下没有消声器的噪音。</p>
<hr>
<p>我来到市中心的哈根达斯店旁，打量着它。比我印象中要小。也许是当年服务员的气焰太盛（想让我们买华而不实的新品的心理太焦急），让我对它的体量的印象有了偏差。也许它因为服务质量不好业绩太差租不起房子。</p>
<p>绕过鼓楼望向回民街。没有人烟。只有零星的僵尸招牌。虽然是理论上的市中心，不过还是让我有所顾忌不敢进去。</p>
<p>来到鼓楼前印象中宽阔热闹的小广场。</p>
<p>每一棵树四周都有一圈长椅。我想挑一个歇歇脚。</p>
<p>几乎每一个长椅上都躺着一名流浪汉。</p>
<p>我一路挑到路边。旁边一棵树下的人没有睡，坐在椅子上。不过我想他应该不太可能和我有相似的经历。</p>
<hr>
<p>早餐的摊位陆陆续续的被推了出来。令我惊讶的是，它们几乎都是一个品牌的加盟……摊。还打出了口号：</p>
<blockquote>
<p>早餐，午餐，晚餐，都从xxxx开始。</p>
</blockquote>
<p>我想象了一下自己去路边摊买午饭的情景。</p>
<p>路边的连锁小型超市也几乎都是一个品牌。其招牌与7-11基本只有名字的区别。为什么大城市的街边超市可以繁荣而小城市不行，这依然是个未解之谜。</p>
<p>我一共在这些超市里买了两瓶水。喝了一瓶半。</p>
<hr>
<p>最终我到达了大明宫。我本打算来看日出，然而却发现东边被云覆盖。我还是爬到了制高点，虽然还是没有身边的树高。耳朵除了各种生灵的鸣叫外，还有持续不断的人的呼喊。这是晨练的人们在呼喊。这里的树木让这些分散在各处的人彼此不现面目，从而很好的避免了当面大吼的尴尬。同时，类似于狼群的本能又让人在身边传来呼喊时很想跟着喊一嗓子。</p>
<p>我也这么想着，于是提了一口气。在我发出声音前短短的一段时间里，我感觉到自己心跳达到了140，其加速堪比法拉利。这导致我的声音颤抖了一下才平稳下来。</p>
<p>我喝了一口水。这也太怂了。想想自己口无遮拦的时候。真是该紧张的时候不紧张，不该紧张的时候瞎紧张。</p>
<p>大概是很久没有这样按照声带进化的本意进行发声了。我喊了几次，都找不到气沉丹田的感觉。喉咙不舒服。</p>
<p>身边一个老人过来掏垃圾桶。然后他把装了瓶子的口袋挂在一棵树上，坐在一旁的椅子上轻松地开始高难度的拉伸运动。跟他们比我简直就是个废物。</p>
<p>“大家早上好！”各种吼叫声中夹杂着这样一句。“早上好——早上好——”来自四面八方的回复。</p>
<p>“起得早！”“起得早——”“身体好！”“身体好——”</p>
<p>我整个人沐浴在透过云层的阳光中。</p>
<hr>
<ul>
<li>无论做任何事情，都会有风险，即有可能利益小于投入，这是不可避免的。</li>
<li>一般来说，事情总是不会在我们预想麻烦的地方麻烦。努力的作用是让每个地方在麻烦起来的时候都能好处理一点。</li>
<li>不要再心存幻想。每个人都有自己的想象，但我滥用了它。通过幻想我在默默地自大。最终的结果是心理和现实的不一致导致的扭曲。</li>
<li>对自己的奖赏应当先安排好了再执行。执行时不管怎么样都应当按照安排的方式和额度。</li>
<li>尽可能多的独自一人。应当把共享当做是合作的一种要求，而不是默认设定。</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;可不是梦游哦。&lt;/p&gt;
&lt;p&gt;PS：西安地铁三号线的声音真是令人惊艳。&lt;/p&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>4b的下一个进化步骤</title>
    <link href="https://oziroe.github.io/2017/07/04/4b%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E8%BF%9B%E5%8C%96%E6%AD%A5%E9%AA%A4/"/>
    <id>https://oziroe.github.io/2017/07/04/4b的下一个进化步骤/</id>
    <published>2017-07-04T04:27:08.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>好久不见。虽然看了看时间，上一篇文章不过过去了一周有余，但还是有种自己已经把写博客的习惯丢掉了的恐惧。</p>
<a id="more"></a>
<p>贯彻<a href="/2017/06/19/有关于数据结构角色和组织方式的一点思考/" title="上一篇相关文章">上一篇相关文章</a>的思想，我重新写了4b……其实不是。我发现贝塞尔曲线本身的复杂度超过了我的接受能力，所以将其改为直线，先写出了一个叫做4l的版本……其实也不是。我还没有写完用四种颜色填充图片的算法，所以大概只能叫rl(random colors background with lines)。之所以没有写完是因为自己实现的朴素算法在处理一些边界条件和浮点数相关的时候没有足够的经验，导致程序的崩溃率在95%左右。</p>
<p>于是，我采用了一套解决方案。首先，改变技术栈。C++本身的复杂度依然是个问题。原本计划换成Swift，奈何它对于非App开发过于不友好。于是在首先由于个人原因排除了Python的前提下，选了Ruby。这货我一直都有一定的好感，其语言特性有一丝LISP的味道。而且其C API比Python简洁得多，之后遇到一定会有的用C拓展的阶段也会是个优势。</p>
<p>然后，我需要专业知识的辅助。是的，就是这样一个小程序，一个用来生成符合我口味的桌面壁纸的小程序，现在要害得我啃英文大部头了。学了这些知识只为了写这一个程序性价比可不高。于是我决定看<a href="http://download.csdn.net/download/neoxiong/9839916" target="_blank" rel="external">PBRT</a>，之后真正将其中的技术尽量都转化到这个小程序里面。</p>
<p>路漫漫其修远兮。各位保重，我可能又要好久不见了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;好久不见。虽然看了看时间，上一篇文章不过过去了一周有余，但还是有种自己已经把写博客的习惯丢掉了的恐惧。&lt;/p&gt;
    
    </summary>
    
    
      <category term="4b" scheme="https://oziroe.github.io/tags/4b/"/>
    
      <category term="Ruby" scheme="https://oziroe.github.io/tags/Ruby/"/>
    
      <category term="Swift" scheme="https://oziroe.github.io/tags/Swift/"/>
    
      <category term="pbrt" scheme="https://oziroe.github.io/tags/pbrt/"/>
    
  </entry>
  
  <entry>
    <title>噩梦记</title>
    <link href="https://oziroe.github.io/2017/07/04/%E5%99%A9%E6%A2%A6%E8%AE%B0/"/>
    <id>https://oziroe.github.io/2017/07/04/噩梦记/</id>
    <published>2017-07-04T04:18:21.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>这个夜晚开始得比较晚。记住了最后一个梦，估计已是日上三竿时的作品了吧。</p>
<p>梦里我去了你住的小区，楼宇布局和我学校宿舍楼类似。我要在自己单方面约定的时间等着你。我穿过初中母校，经过一个从来没有开过的门，碰到一些学校教职工。我进了你的小区，却不记得约定的楼在哪里。我沿着横平竖直的楼房，焦急地奔跑着，呼喊着，害怕会错过你。</p>
<p>看样子，一时半会，你是不会离开我的了。</p>
<p>你说要点亮自己，我又何尝不是。希望那一天早点到来。我足够明亮，以至于任何的你都不会使我面临与现在的困境类似的情况的那一天。</p>
<hr>
<p>以上为陷入《约会大作战》OVA而难过之后的疯言疯语。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这个夜晚开始得比较晚。记住了最后一个梦，估计已是日上三竿时的作品了吧。&lt;/p&gt;
&lt;p&gt;梦里我去了你住的小区，楼宇布局和我学校宿舍楼类似。我要在自己单方面约定的时间等着你。我穿过初中母校，经过一个从来没有开过的门，碰到一些学校教职工。我进了你的小区，却不记得约定的楼在哪里。我
    
    </summary>
    
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
      <category term="做梦" scheme="https://oziroe.github.io/tags/%E5%81%9A%E6%A2%A6/"/>
    
  </entry>
  
  <entry>
    <title>二梦记</title>
    <link href="https://oziroe.github.io/2017/06/27/%E4%BA%8C%E6%A2%A6%E8%AE%B0/"/>
    <id>https://oziroe.github.io/2017/06/27/二梦记/</id>
    <published>2017-06-27T03:47:59.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/4b-step1.png" alt="4b早期作品"></p>
<a id="more"></a>
<p>昨晚做了两个梦。</p>
<p>一个说我在家里，被人打劫了。我家族里大概是有黑帮势力，所以这是一次黑吃黑。</p>
<p>有人闯进来的时候我愣了好久，估计有五六秒。在想怎么解释以逃脱。</p>
<p>醒来觉得自己的情商还是太低了。</p>
<p>后半段的梦太过于模糊和混乱。只记得爸妈大概知道了，回来了，两方势力正在打口水仗。</p>
<p>空气中弥漫着劫匪片的紧张气氛，然而我的大脑却不知道劫匪片该安排什么剧情。</p>
<p>考虑到是它的初次尝试就不予追究了。下次不要再像这样，怂恿我来写一篇博客，却让我连情节都找不出一点。</p>
<hr>
<p>然后，醒来关一个闹钟，两个。回到梦里，这次是关于你的。</p>
<p>我坐在有你的教室里。你在我右手边，隔了一个，两个人。也许加上一条过道。</p>
<p>我不知道你的高中老师的样貌，所以梦中安排了初中班主任和语文老师站在讲台上，发物理试卷。我也不知道你的班级发试卷的情景，所以放了几个大学发作业的镜头。</p>
<p>老师训斥我，说我每一科都差点不及格，决不能再这样下去了。</p>
<p>我在梦中下定决心，我要好好学习，学好之前都不理你了。</p>
<p>最后的镜头大概是窗外，又是一副电影常用的结局的嘴脸。不过没什么感觉就是了。</p>
<hr>
<p>原本准备了一大段的抒情，却又不想写了。</p>
<p>原本在考虑要不要把链接发给你，却又犹豫了。</p>
<p>该相遇的人和文字自然会相遇，该懂的人自然会懂。该解不开的心结，谁来帮忙也是无济于事。一切还是看缘分吧。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/4b-step1.png&quot; alt=&quot;4b早期作品&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
      <category term="做梦" scheme="https://oziroe.github.io/tags/%E5%81%9A%E6%A2%A6/"/>
    
  </entry>
  
  <entry>
    <title>有关于数据结构角色和组织方式的一点思考</title>
    <link href="https://oziroe.github.io/2017/06/19/%E6%9C%89%E5%85%B3%E4%BA%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A7%92%E8%89%B2%E5%92%8C%E7%BB%84%E7%BB%87%E6%96%B9%E5%BC%8F%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/"/>
    <id>https://oziroe.github.io/2017/06/19/有关于数据结构角色和组织方式的一点思考/</id>
    <published>2017-06-19T02:51:37.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>也许数据结构不应该过于追求通用性。</p>
<p>我大概是被STL影响了吧。一整套的基本数据结构，以及搭配的基本算法，还可以随便排列组合，多么美好。</p>
<p>可是它怎么就没有图呢。用的时候，怎么就要考虑那么多拷贝构造函数，RTTI，甚至是智能指针之类的麻烦事呢。</p>
<p>数据结构不应该作为一种设计模式存在。就算两个图的功能再像，只要它是两个图，背后的含义就是不一样的。</p>
<p>更不必说，对于不同使用场景的相同结构，从前期的坑到后期的优化点，都是完全不一样的。</p>
<p>通用容器只能提供最基本的抽象。就像智能指针，也只能用引用计数，而永远不可能换用效率更高的算法。限制太多了。</p>
<p>如果真的想更通用一点，那就只能用动态语言了。即便如此，还是没人在标准库里写图，写最小生成树，写霍夫曼树。</p>
<p>得不偿失的行为。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;也许数据结构不应该过于追求通用性。&lt;/p&gt;
&lt;p&gt;我大概是被STL影响了吧。一整套的基本数据结构，以及搭配的基本算法，还可以随便排列组合，多么美好。&lt;/p&gt;
&lt;p&gt;可是它怎么就没有图呢。用的时候，怎么就要考虑那么多拷贝构造函数，RTTI，甚至是智能指针之类的麻烦事呢。&lt;/p
    
    </summary>
    
    
      <category term="4b" scheme="https://oziroe.github.io/tags/4b/"/>
    
      <category term="破事水" scheme="https://oziroe.github.io/tags/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
      <category term="数据结构" scheme="https://oziroe.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>眼光与耳光（水）</title>
    <link href="https://oziroe.github.io/2017/06/16/%E7%9C%BC%E5%85%89%E4%B8%8E%E8%80%B3%E5%85%89%EF%BC%88%E6%B0%B4%EF%BC%89/"/>
    <id>https://oziroe.github.io/2017/06/16/眼光与耳光（水）/</id>
    <published>2017-06-16T12:18:06.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>为什么眼光和耳光，是两个意思完全不一样的词呢？</p>
<p>如果我想形容一个人鉴赏音乐的“眼光”，该用什么词呢？</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;为什么眼光和耳光，是两个意思完全不一样的词呢？&lt;/p&gt;
&lt;p&gt;如果我想形容一个人鉴赏音乐的“眼光”，该用什么词呢？&lt;/p&gt;

    
    </summary>
    
    
      <category term="破事水" scheme="https://oziroe.github.io/tags/%E7%A0%B4%E4%BA%8B%E6%B0%B4/"/>
    
  </entry>
  
  <entry>
    <title>某数据结构实验报告（水）</title>
    <link href="https://oziroe.github.io/2017/06/14/%E6%9F%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A%EF%BC%88%E6%B0%B4%EF%BC%89/"/>
    <id>https://oziroe.github.io/2017/06/14/某数据结构实验报告（水）/</id>
    <published>2017-06-14T15:01:53.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>居然还有<a href="http://www.zamzar.com/convert/pdf-to-html/" target="_blank" rel="external">这种操作</a>，真是厉害。</p>
<a id="more"></a>
<iframe src="/html/某数据结构实验报告.html" style="width:100%; height: 35100px"></iframe>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;居然还有&lt;a href=&quot;http://www.zamzar.com/convert/pdf-to-html/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这种操作&lt;/a&gt;，真是厉害。&lt;/p&gt;
    
    </summary>
    
    
      <category term="C" scheme="https://oziroe.github.io/tags/C/"/>
    
      <category term="数据结构" scheme="https://oziroe.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>逃学归家而无病呻吟</title>
    <link href="https://oziroe.github.io/2017/06/12/%E9%80%83%E5%AD%A6%E5%BD%92%E5%AE%B6%E8%80%8C%E6%97%A0%E7%97%85%E5%91%BB%E5%90%9F/"/>
    <id>https://oziroe.github.io/2017/06/12/逃学归家而无病呻吟/</id>
    <published>2017-06-11T16:51:21.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>原本应该是“归家有感”的标题被硬生生改成这样。唉，没办法，我就是受不了参差不齐的文件名。</p>
<p>说是“逃学”，其实也是有请假单的。只是此时此刻室友们大概还在备战下周的五门考试，而我却刚刚写了个热水澡，坐在这里畅想明天与女朋友相见，实在有点莫名的心虚。</p>
<p>不过这点心虚应该还是值得的。毕竟，人生中能同时体会到高考结束、长大成人和男朋友突然出现的喜悦的机会也就那么一次半次。嗯，你看，没有人打我的时候我能把自己塑造得多么高尚啊。</p>
<a id="more"></a>
<p>排队安检时前面的女生对着手机大声发着一条条语音：“你还没结婚就花了快二十万了你自己想想为了她值得吗……而且还不一定能结婚……”“法律上来说她不用和你一起付完按揭……”“我觉得你脑子被门夹了……”突然觉得自己活在蜜罐里。</p>
<p>深夜坐着老爸开的车回家。他精神有点萎靡，打着哈欠，差点闯红灯。感觉很对不起父母，明明是自己贪图享乐还要把他们牵扯进来。</p>
<p>班机上邻座的女生指着前排靠背背面的广告对同伴说：“你看它这是不是写错了，‘开户即享佣金万2.5’，应该是2.5万吧。”“然后还印了那么多遍。”同伴表示赞同和惋惜。我刚在内心嘲讽完她们的愚昧，就不得不再嘲讽一次我自己的自大。</p>
<p>洗澡前看了一眼镜子中的自己。真的瘦。想起这学期出发前曾在镜子前拍了一张，用来在现在发一条对比的动态以展示一个学期的坚持锻炼有多大用处，然而……我好像更瘦了……肋骨都能看到两端了。还好我把存放那张照片的手机留在了学校。</p>
<p>忘了哪一个牙刷是自己的。老爸说：“你看这个上面牙膏这么多，一定是你的。”……原本我以为女朋友所说的“你的东西都旧得很一致”是她观察力敏锐的结果，原来身边的人早已达成了共识……好吧。</p>
<hr>
<p>所以为什么会有这篇文字呢？</p>
<p>今天在考场上第一次遇到了作文凑字吃力的情况。回忆了一下，我每天的写作主要分为毫无感情的技术介绍和超级隐晦的情感宣泄两种，一般人能看懂的部分太少了。我需要多写一些“正常”的东西。</p>
<p><strong>还有，这不是一个纯技术博客。</strong></p>
<p>冥冥之中我预感刚刚开始的今天我会玩得很high，不会有空写代码，为了不让commit断掉所以……【逃</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;原本应该是“归家有感”的标题被硬生生改成这样。唉，没办法，我就是受不了参差不齐的文件名。&lt;/p&gt;
&lt;p&gt;说是“逃学”，其实也是有请假单的。只是此时此刻室友们大概还在备战下周的五门考试，而我却刚刚写了个热水澡，坐在这里畅想明天与女朋友相见，实在有点莫名的心虚。&lt;/p&gt;
&lt;p&gt;不过这点心虚应该还是值得的。毕竟，人生中能同时体会到高考结束、长大成人和男朋友突然出现的喜悦的机会也就那么一次半次。嗯，你看，没有人打我的时候我能把自己塑造得多么高尚啊。&lt;/p&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="https://oziroe.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>有关于pip、lxml和Minecraft的坑各一则</title>
    <link href="https://oziroe.github.io/2017/06/10/%E6%9C%89%E5%85%B3%E4%BA%8Epip%E3%80%81lxml%E5%92%8CMinecraft%E7%9A%84%E5%9D%91%E5%90%84%E4%B8%80%E5%88%99/"/>
    <id>https://oziroe.github.io/2017/06/10/有关于pip、lxml和Minecraft的坑各一则/</id>
    <published>2017-06-10T06:58:52.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>流年不利。</p>
<a id="more"></a>
<hr>
<p>pip的配置文件在linux/macOS和Windows当中下的路径是不同的。参考<a href="http://www.cnblogs.com/yudar/p/4444097.html" target="_blank" rel="external">这篇博客</a>，在Windows下的路径为<code>%HOMEPATH%\pip\pip.ini</code>，而不是<code>~/.pip/pip.conf</code>。</p>
<hr>
<p>最近lxml更新到了3.8.0，然而该版本在Windows上无法使用。具体症状是<code>from lxml import etree</code>会出现DLL找不到的情况。解决方案是回退到3.7.3版本即可。</p>
<hr>
<p>Minecraft更新了1.12正式版，然而……崩溃了。</p>
<p><img src="/images/Minecraft报错信息.png" alt="报错信息"></p>
<p>看起来并没有找到一个叫做<code>ca.weblite.objc.NSObject</code>的类……开玩笑吗你找不到Objective-C的爷爷类。希望不是因为盗版登录器的兼容问题吧。毕竟我还只是弱鸡一个，没钱给自己买正版。</p>
<p><span style="color: grey">从今天起，少说废话，节约各位看官的生命。</span></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;流年不利。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://oziroe.github.io/tags/Python/"/>
    
      <category term="Bug" scheme="https://oziroe.github.io/tags/Bug/"/>
    
      <category term="Minecraft" scheme="https://oziroe.github.io/tags/Minecraft/"/>
    
      <category term="pip" scheme="https://oziroe.github.io/tags/pip/"/>
    
      <category term="Java" scheme="https://oziroe.github.io/tags/Java/"/>
    
      <category term="macOS" scheme="https://oziroe.github.io/tags/macOS/"/>
    
      <category term="Cacoa" scheme="https://oziroe.github.io/tags/Cacoa/"/>
    
      <category term="lxml" scheme="https://oziroe.github.io/tags/lxml/"/>
    
      <category term="DLL" scheme="https://oziroe.github.io/tags/DLL/"/>
    
      <category term="Windows" scheme="https://oziroe.github.io/tags/Windows/"/>
    
      <category term="Objective-C" scheme="https://oziroe.github.io/tags/Objective-C/"/>
    
  </entry>
  
  <entry>
    <title>离散数学代数系统部分的归纳整理</title>
    <link href="https://oziroe.github.io/2017/06/09/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%BB%A3%E6%95%B0%E7%B3%BB%E7%BB%9F%E9%83%A8%E5%88%86%E7%9A%84%E5%BD%92%E7%BA%B3%E6%95%B4%E7%90%86/"/>
    <id>https://oziroe.github.io/2017/06/09/离散数学代数系统部分的归纳整理/</id>
    <published>2017-06-09T09:18:11.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/代数系统.png" alt="代数系统简图"></p>
<p>每一次画示意图，我都发誓这是我最后一次画示意图。神呐救救我的布局吧。</p>
<a id="more"></a>
<ol>
<li>集合的性质是由公理得出的。</li>
<li>两个集合的叉积（笛卡尔积）的一个子集称为这两个集合上的关系。<ul>
<li>等价关系的证明：<strong>自反</strong>、<strong>对称</strong>、<strong>传递</strong>。</li>
<li>半序关系的证明：<strong>自反</strong>、<strong>反对称</strong>、<strong>传递</strong>。</li>
</ul>
</li>
<li>函数的证明：<strong>左满右唯一</strong>。</li>
<li>运算的证明：<strong>封闭性</strong>。<ol>
<li>通常出现在群上运算的规律：<strong>结合律</strong>，<strong>交换律</strong>，<strong>分配率</strong>。<ul>
<li>对于某两个运算$\otimes$和$\oplus$，则<strong>$\otimes$对$\oplus$的分配率</strong>：$a \otimes (b \oplus c) = (a \otimes c) \oplus (b \otimes c)$。注意哪一个在里面。</li>
</ul>
</li>
<li>通常出现在格上运算的规律：<strong>吸收率</strong>，<strong>幂等律</strong>，<strong>交换律</strong>，<strong>结合律</strong>，<strong>模律</strong>。模律是对称的。</li>
<li>通常出现在群上运算的特殊元素：<strong>零元</strong>、<strong>幺元</strong>、<strong>零因子</strong>、<strong>逆元</strong>、<strong>生成元</strong>。</li>
<li>通常出现在格上运算的特殊元素：<strong>补元</strong>。</li>
<li>通常用来组成群上运算的基本运算：<strong>加</strong>、<strong>乘</strong>、<strong>模加</strong>、<strong>模乘</strong>。</li>
<li>通常用来组成格上运算的基本运算：<strong>最大公约数</strong>、<strong>最小公倍数</strong>、<strong>交</strong>（与）、<strong>并</strong>（或）、<strong>补</strong>（非）。</li>
</ol>
</li>
<li>代数系统的证明：<strong>运算封闭</strong>。<ul>
<li>子代数系统证明：<strong>非空</strong>、<strong>包含</strong>、<strong>运算封闭</strong>。</li>
</ul>
</li>
<li>半群的证明：<strong>运算封闭</strong>、<strong>结合律</strong>。<ul>
<li>子半群的证明：<strong>非空</strong>、<strong>包含</strong>、<strong>运算封闭</strong>。（结合律继承）</li>
</ul>
</li>
<li>群的证明：<strong>运算封闭</strong>、<strong>结合律</strong>、<strong>有幺元</strong>、<strong>每个元素都有逆元</strong>。<ul>
<li>子群的证明：<strong>非空</strong>、<strong>包含</strong>、<strong>幺元属于子集</strong>、<strong>运算的混合封闭性</strong>：$\forall x,y \in S,\, x \oplus y^{-1} \in S$。（结合律继承）</li>
</ul>
</li>
</ol>
<p><span style="color: grey">剩下的还没复习完，未完待续。</span></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/代数系统.png&quot; alt=&quot;代数系统简图&quot;&gt;&lt;/p&gt;
&lt;p&gt;每一次画示意图，我都发誓这是我最后一次画示意图。神呐救救我的布局吧。&lt;/p&gt;
    
    </summary>
    
    
      <category term="离散数学" scheme="https://oziroe.github.io/tags/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/"/>
    
      <category term="代数系统" scheme="https://oziroe.github.io/tags/%E4%BB%A3%E6%95%B0%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>博客改版，格式微调实记</title>
    <link href="https://oziroe.github.io/2017/06/08/%E5%8D%9A%E5%AE%A2%E6%94%B9%E7%89%88%EF%BC%8C%E6%A0%BC%E5%BC%8F%E5%BE%AE%E8%B0%83%E5%AE%9E%E8%AE%B0/"/>
    <id>https://oziroe.github.io/2017/06/08/博客改版，格式微调实记/</id>
    <published>2017-06-08T14:51:27.000Z</published>
    <updated>2017-07-30T05:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>作为一个静态博客框架，Hexo已经足够优秀。只是或多或少有一点Bug存在，不知为何。这篇文章记录了一些微调和修改，以使整个网站看上去更加正常。</p>
<a id="more"></a>
<hr>
<p>这个其实几天前就忍不了了……更换了页头的背景图，因为默认的实在看不清副标题。用这张图替换<code>themes/landscape/source/css/images/banner.jpg</code>即可。</p>
<p><img src="/images/封面图.jpg" alt="新的封面图"></p>
<hr>
<p>更换了字体为Open Sans。这个字体是从Typora的配置里面拿出来的，用Typora的时候实在是眼馋得不得了。将Typora主题文件夹里的<code>github</code>文件夹复制到博客的<code>themes/landscape/source/css/fonts</code>文件夹下，然后添加文件<code>themes/landscape/source/css/github-font.css</code>，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">include</span>-<span class="keyword">when</span>-<span class="keyword">export</span> url(http://fonts.googleapis.com/css?family=Open+Sans:<span class="number">400</span>italic,<span class="number">700</span>italic,<span class="number">700</span>,<span class="number">400</span>&amp;subset=latin,latin-ext);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* css forked from https://github.com/GitbookIO/gitbook</span></div><div class="line"><span class="comment">* www.gitbook.com</span></div><div class="line"><span class="comment">* Apache License</span></div><div class="line"><span class="comment">* https://github.com/GitbookIO/gitbook/blob/master/LICENSE</span></div><div class="line"><span class="comment">**/</span></div><div class="line"></div><div class="line">@<span class="keyword">font-face</span> &#123;</div><div class="line">   <span class="attribute">font-family</span>: <span class="string">'Open Sans'</span>;</div><div class="line">   <span class="attribute">font-style</span>: normal;</div><div class="line">   <span class="attribute">font-weight</span>: normal;</div><div class="line">   <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Open Sans Regular'</span>),<span class="built_in">url</span>(<span class="string">'./fonts/github/400.woff'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">font-face</span> &#123;</div><div class="line">   <span class="attribute">font-family</span>: <span class="string">'Open Sans'</span>;</div><div class="line">   <span class="attribute">font-style</span>: italic;</div><div class="line">   <span class="attribute">font-weight</span>: normal;</div><div class="line">   <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Open Sans Italic'</span>),<span class="built_in">url</span>(<span class="string">'./fonts/github/400i.woff'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">font-face</span> &#123;</div><div class="line">   <span class="attribute">font-family</span>: <span class="string">'Open Sans'</span>;</div><div class="line">   <span class="attribute">font-style</span>: normal;</div><div class="line">   <span class="attribute">font-weight</span>: bold;</div><div class="line">   <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Open Sans Bold'</span>),<span class="built_in">url</span>(<span class="string">'./fonts/github/700.woff'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">@<span class="keyword">font-face</span> &#123;</div><div class="line">   <span class="attribute">font-family</span>: <span class="string">'Open Sans'</span>;</div><div class="line">   <span class="attribute">font-style</span>: italic;</div><div class="line">   <span class="attribute">font-weight</span>: bold;</div><div class="line">   <span class="attribute">src</span>: <span class="built_in">local</span>(<span class="string">'Open Sans Bold Italic'</span>),<span class="built_in">url</span>(<span class="string">'./fonts/github/700i.woff'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这一段是从Typora的<code>github.css</code>文件中复制出来的，看起来Typora是从Gitbook复制的。对原作者表示感谢。文件路径稍有更改。</p>
<p>在同目录下的<code>style.styl</code>中添加一行：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@import <span class="string">"github-font.css"</span></div></pre></td></tr></table></figure>
<p>即可大功告成。</p>
<hr>
<p>原本的日期显示有一点问题。修改<code>themes/landscape/layout/_widget/archive.ejs</code>中的日期格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;% if (site.posts.length)&#123; %&gt;</div><div class="line">  &lt;div class=&quot;widget-wrap&quot;&gt;</div><div class="line">    &lt;h3 class=&quot;widget-title&quot;&gt;&lt;%= __(&apos;archive_a&apos;) %&gt;&lt;/h3&gt;</div><div class="line">    &lt;div class=&quot;widget&quot;&gt;</div><div class="line">      &lt;%- list_archives(&#123;show_count: theme.show_count, type: theme.archive_type, format: &apos;YYYY年M月&apos;&#125;) %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;% &#125; %&gt;</div></pre></td></tr></table></figure>
<p>注意第五行的格式变化。类似的还有<code>themes/landscape/layout/_partial/archive-post.ejs</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;article class=&quot;archive-article archive-type-&lt;%= post.layout %&gt;&quot;&gt;</div><div class="line">  &lt;div class=&quot;archive-article-inner&quot;&gt;</div><div class="line">    &lt;header class=&quot;archive-article-header&quot;&gt;</div><div class="line">      &lt;%- partial(&apos;post/date&apos;, &#123;class_name: &apos;archive-article-date&apos;, date_format: &apos;M月D日&apos;&#125;) %&gt;</div><div class="line">      &lt;%- partial(&apos;post/title&apos;, &#123;class_name: &apos;archive-article-title&apos;&#125;) %&gt;</div><div class="line">    &lt;/header&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/article&gt;</div></pre></td></tr></table></figure>
<p>注意第四行的日期格式。这样做损失了多国语言的兼容性，不过参考<a href="https://hexo.io/zh-cn/docs/helpers.html#list-archives" target="_blank" rel="external">官方文档</a>也没有看出什么名堂。希望有更好的办法吧。</p>
<hr>
<p>在主题的配置文件<code>_config.yml</code>当中去掉了fancybox效果，去掉了tag边栏。前者加载太慢了，对移动端的兼容也不太好；后者纯属个人喜好。</p>
<hr>
<p>大概的改动就是这些。默认主题landscape可以满足大多数日常所需，曾经做得大改动就是改了tag的位置并且为其加上了五颜六色的背景色。不过这回应该不会这样做了吧。</p>
<p>为什么高亮没有EJS。是不是应该换一个……算了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;作为一个静态博客框架，Hexo已经足够优秀。只是或多或少有一点Bug存在，不知为何。这篇文章记录了一些微调和修改，以使整个网站看上去更加正常。&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="https://oziroe.github.io/tags/hexo/"/>
    
      <category term="oziroe.github.io" scheme="https://oziroe.github.io/tags/oziroe-github-io/"/>
    
      <category term="ejs" scheme="https://oziroe.github.io/tags/ejs/"/>
    
      <category term="stylus" scheme="https://oziroe.github.io/tags/stylus/"/>
    
      <category term="typora" scheme="https://oziroe.github.io/tags/typora/"/>
    
      <category term="css" scheme="https://oziroe.github.io/tags/css/"/>
    
  </entry>
  
</feed>
